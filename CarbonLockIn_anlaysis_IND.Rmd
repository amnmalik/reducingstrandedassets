---
title: "Carbon Lock-in  CD LINKS"
author: "Aman Malik and Christoph Bertram"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    theme: paper
    toc: yes
    toc_float:
      collapsed: no
  pdf_document:
    toc: yes
---
```{r global settings, include=FALSE}
# setting global settings for knitr
# echo=TRUE/FALSE whether to include R source code in the output file
# knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.path = "figure-carbonlockin/",cache = TRUE,echo=FALSE)
```


```{r comments knitr}
#### Some comments on knitr arguments ########
#warnings=FALSE, switches off all warnings from the trunk
#eval = FALSE, doesn't evaluate the chunk. Useful for packages that are not yet open-source, e.g., moinput
# include=FALSE, suppresses messages associated with loading packages
```

```{r req packages,message=FALSE, warning=FALSE, include=FALSE,results='hide'}
library(quitte)
library(mrremind)
library(tidyverse)
library(reshape)
library(data.table)
library(RColorBrewer)
library(knitr)
library(mip)
library(readxl)
```


```{r input data preperation,include=FALSE,eval=FALSE,message=FALSE,purl=FALSE,warning=FALSE}
#read in data


#all <- fread(input = "~/PROJECTS/CD-LINKS/Database/factsheet/Carbon lock in/Data/cdlinks_compare_20190808-112005.csv",header = TRUE, sep = ',')
all <- fread(input = "~/PROJECTS/Carbon lock in/Data/cdlinks_compare_20191202-092954.csv  ",header = TRUE, sep = ',')
#filter for desired set of time series
models <- unique(all$MODEL)
regions <- "IND" # unique(all$REGION)
scens <- unique(all$SCENARIO)
# How were these variables selected?
# variables <- as.character(read.csv2("plotstyles_CLI.csv")$name)
variables <- grep("Diagnostics",unique(all$VARIABLE),value=TRUE,fixed = TRUE)

all  <- all[all$MODEL %in% models & all$SCENARIO %in% scens & all$REGION %in% regions & !(all$VARIABLE %in% variables),]

all <- invisible(melt(all,measure.vars=names(all)[grep("[0-9]+",names(all))],variable.name = "period",variable.factor=FALSE))
all$period <- as.numeric(all$period)

all <- all[!period %in% c(1950,1955,1960,1965,1970,1975,1980,1985,1990,1995,2000,2001,2002,2003,2004,2006,2007,2008,2009,2011,2012,2013,2014,2016,2017,2018,2019,2021,2022,2023,2024,2026,2027,2028,2029,2031,2032,2033,2034,2036,2037,2038,2039,2041,2042,2043,2044,2046,2047,2048,2049,2051,2052,2053,2054,2056,2057,2058,2059,2061,2062,2063,2064,2066,2067,2068,2069,2071,2072,2073,2074,2076,2077,2078,2079,2081,2082,2083,2084,2086,2087,2088,2089,2091,2092,2093,2094,2096,2097,2098,2099,2101,2102,2103,2104,2106,2107,2108,2109)]
# Rename columns
setnames(all, "MODEL", "model")
setnames(all, "SCENARIO", "scenario")
setnames(all, "REGION", "region")
setnames(all, "VARIABLE", "variable")
setnames(all, "UNIT", "unit")

all  <- na.omit(all) # remove rows containing NAs

#get rid of scenarios not interesting for us, including Currently implemented policies and INDC
scens_other <- c(grep("USD|Food|domestic|flexibility|SSP|NoP",unique(all$scenario),value=TRUE))
all <- all[!scenario %in% scens_other]

#get rid of V3 variants for models that have V4 and v4 variants for models that have v5
#vscens <- grep("_V",unique(all$scenario),value=TRUE,invert = TRUE)
#v3scens <- grep("_V3",unique(all$scenario),value=TRUE)
v4scens <- grep("_V4",unique(all$scenario),value=TRUE)
v5scens <- grep("_V5",unique(all$scenario),value=TRUE)
#models with no version number in scenarios
#vmods <- unique(all[scenario %in% vscens]$model)
# models with v3 number in scenarios
#v3mods <- unique(all[scenario %in% v3scens]$model)
# models with v4 number in scenarios
v4mods <- unique(all[scenario %in% v4scens]$model)
v5mods <- unique(all[scenario %in% v5scens]$model)
v4mods <- setdiff(v4mods,v5mods)
#v3mods <- setdiff(v3mods,c(v4mods,v5mods))
#vmods <- setdiff(vmods,c(v4mods,v5mods,v3mods))
# all <- rbdind(all[model %in% v5mods & scenario %in% v5scenes],all[!model %in% v4mods,   ]
#all <- rbind(all[model %in% vmods & scenario %in% vscens],all[model %in% v3mods & scenario %in% v3scens],all[model %in% v5mods & scenario %in% v5scens],all[model %in% v4mods & scenario %in% v4scens])
all <- rbind(all[!model %in% c(v4mods,v5mods)],all[model %in% v5mods & scenario %in% v5scens],all[model %in% v4mods & scenario %in% v4scens])

#make variables a factor, so that the order in facets can be manipulated easily
all$variable <- factor(all$variable)
all$model1 <- all$model
all$scenario1 <- all$scenario
all <- unite(all,col="modscen",c("model1","scenario1"),sep = " - ")
#make variables a factor, so that the order in facets can be manipulated easily
all$model <- factor(all$model)
all$scenario <- factor(all$scenario)
all$modscen <- factor(all$modscen)
# Classifying all models into global and national
all <- all %>% 
  mutate(model_scope=ifelse(model=="India MARKAL"|model=="AIM/Enduse 3.0","national","global"))

# REMOVING PROBLEMATIC/INCOMPATIBLE MODELS
 all <- all %>% 
 filter(!model %in% c("AIM/CGE",grep("MESSAGE|GLOBIOM|COPPE|DNE21",unique(all$model),value=TRUE)))

# Early scenarios
early <- all[all$scenario %in% c("NPi2020_1000_V5","NPi2020_1000_V4","NPi2020_1000_V3","NPi2020_low_V3","NPi2020_low_V4","NPi2020_1000_recGenTaxation_V4"),]
early <- add_column(early,scen_name = "Early action")
# Delay scenario
delay   <- all[all$scenario %in% c("INDC2030i_1000_V4","INDC2030i_1000_V5","INDC2030i_1000_V3","INDC2030_low_V3","INDC2030_low_V4","INDC2030i_1000_recGenTaxation_V4"),]
delay <-  add_column(delay,scen_name = "Delayed action")
# NDC scenario
ndc <- all[all$scenario %in% c("INDCi_V4","INDCi_V5","INDC_V4","INDC_V5"),]
ndc <-  add_column(ndc,scen_name = "NDC")
# NPi Scenario
npi <- all[all$scenario %in% c("NPi_V4","NPi_V5","NPip_V4","NPip_V5"),]
npi <-  add_column(npi,scen_name = "NPi")
whole <- rbind(early,delay,ndc,npi)

#Adding a solar variable "Capacity|Electricity|Solar" for a few models
whole_j <- whole[whole$variable %in% "Capacity|Electricity|Solar|PV" & whole$model %in% c("AIM V2.1", "REMIND-MAgPIE 1.7-3.0"),]

whole_j$variable <- "Capacity|Electricity|Solar"
whole <- rbind(whole,whole_j)

### AIM ENDUSE capacity

### Capacity|Electricity|Coal|w/o CCS for AIM ENDUSE for Delayed action is not given. Calculating the capacity factor for delay scenario and using it for early scenario.

whole_coal_cap <- whole %>% filter(variable %in% c("Capacity|Electricity|Coal|w/o CCS","Secondary Energy|Electricity|Coal|w/o CCS"),model %in% c("AIM/Enduse 3.0"),scen_name=="Early action")

whole_coal_cap <- calc_addVariable(whole_coal_cap, "Capacity Factor|Electricity|Coal|w/o CCS" = "`Secondary Energy|Electricity|Coal|w/o CCS` / `Capacity|Electricity|Coal|w/o CCS` * 31.71")

whole_coal_cap_2 <- whole %>% filter(variable %in% c("Capacity|Electricity|Coal|w/o CCS","Secondary Energy|Electricity|Coal|w/o CCS"),model %in% c("AIM/Enduse 3.0"),scen_name=="Delayed action")

whole_coal_cap_2 <- rbind(whole_coal_cap_2,whole_coal_cap %>% filter(variable=="Capacity Factor|Electricity|Coal|w/o CCS"))

whole_coal_cap_2 <- calc_addVariable(whole_coal_cap, "Capacity|Electricity|Coal|w/o CCS" = "`Secondary Energy|Electricity|Coal|w/o CCS` / `Capacity Factor|Electricity|Coal|w/o CCS` *31.71 ",units = "GW",only.new = TRUE)
whole_coal_cap_2$scen_name <- "Delayed action"
whole_coal_cap_2$scenario <- "INDC2030_low_V4"
whole_coal_cap_2$modscen <- "AIM/Enduse 3.0 - INDC2030_low_V4"

whole <- bind_rows(whole,whole_coal_cap_2)

whole <- as.quitte(whole)
fwrite(whole,"")
#save(whole,file="data_IND2019_05_09.RData")
save(whole,file="Doc/data_IND2019_12_02.RData")
```

```{r AIM SE correction - not used now, eval=FALSE}
# ####### MAKING CHANGES FOR AIM ENDUSE
# reading only results for AIM/ENDUSE
# AIM <- whole %>% filter(model=="AIM/Enduse 3.0")
# # Extracting variables only with SE|Electricity terms
# AIM_SE <- whole %>% filter(variable%in% grep("Secondary Energy|Electricity",unique(whole$variable),fixed = TRUE,value=TRUE) & model=="AIM/Enduse 3.0")
# # Replacing Secondary with Primary Energy
# AIM_SE$variable <- gsub("Secondary",replacement = "Primary",x = AIM_SE$variable)
# AIM_SE$variable <- gsub("\\|Electricity",replacement = "",x = AIM_SE$variable)
# # making variable name in accordance with convention for PE electricity source
# AIM_SE$variable <- paste0(word(AIM_SE$variable,start = 1,sep = "\\|"),"|",word(AIM_SE$variable,start = 2,sep = "\\|"),"|Electricity|",word(AIM_SE$variable,start = 3,sep = "\\|"))
# # removing NAs
# AIM_SE$variable <- gsub(pattern = "\\|NA",replacement = "",x = AIM_SE$variable)
# 
# ## Addiing coal, gas, and fossil w and w/o CCS technologies into one category e.g. coal=coalw/o CCS + coal w/ ccs
# # AIM_SE <- spread(AIM_SE,4,7)
# AIM_SE <- calc_addVariable(AIM_SE,
# "Primary Energy|Coal|Electricity"= "`Primary Energy|Coal|Electricity|w/ CCS`+`Primary Energy|Coal|Electricity|w/o CCS`",
# "Primary Energy|Gas|Electricity"= "`Primary Energy|Gas|Electricity|w/ CCS`+`Primary Energy|Gas|Electricity|w/o CCS`",
# "Primary Energy|Fossil|Electricity"=" `Primary Energy|Fossil|Electricity|w/ CCS`+`Primary Energy|Fossil|Electricity|w/o CCS`",
# "Primary Energy|Solar"="`Primary Energy|Solar|Electricity`",
# "Primary Energy|Wind"="`Primary Energy|Wind|Electricity`",
# "Primary Energy|Hydro" = "`Primary Energy|Hydro|Electricity`",
# "Primary Energy|Nuclear" =" `Primary Energy|Nuclear|Electricity`",units = "EJ/yr")
# AIM_SE <- calc_addVariable(AIM_SE,
#    "Secondary Energy|Electricity|Coal|w/ CCS" = "`Primary Energy|Coal|Electricity|w/ CCS` * 0.33",
#    "`Secondary Energy|Electricity|Coal|w/o CCS`" = "`Primary Energy|Coal|Electricity|w/o CCS`* 0.33",
#               "`Secondary Energy|Electricity|Coal`" = "`Primary Energy|Coal|Electricity`* 0.33",
#              "`Secondary Energy|Electricity|Gas|w/ CCS`" = "`Primary Energy|Gas|Electricity|w/ CCS`* 0.5",
#         "`Secondary Energy|Electricity|Gas|w/o CCS`" = "`Primary Energy|Gas|Electricity|w/o CCS`* 0.5",
#                  "`Secondary Energy|Electricity|Gas`" = "`Primary Energy|Gas|Electricity`* 0.5",
#            "`Secondary Energy|Electricity|Oil`" = "`Primary Energy|Oil|Electricity`* 0.5",
#                 "`Secondary Energy|Electricity|Biomass`" = "`Primary Energy|Biomass|Electricity`* 0.05",
#     "`Secondary Energy|Electricity|Nuclear`" = "`Primary Energy|Nuclear`* 0.33",
#    "`Secondary Energy|Electricity|Hydro`" = "`Primary Energy|Hydro`* 1.0",
#    "`Secondary Energy|Electricity|Solar`" = "`Primary Energy|Solar`* 1.0",
#    "`Secondary Energy|Electricity|Wind`" = "`Primary Energy|Wind`*1.0",
#    "`Secondary Energy|Electricity`" = "`Primary Energy|Electricity`*0.37",units = "EJ/yr")
# 
# 
# # removing primary and secondary energy entries in the original data frame
# whole <- whole %>% filter(!(variable %in%  c("Primary Energy|Oil|Electricity","Primary Energy|Hydro","Primary Energy|Nuclear","Primary Energy|Solar","Primary Energy|Wind","Primary Energy|Coal|Electricity","Primary Energy|Gas|Electricity","Primary Energy|Biomass|Electricity",grep("Secondary Energy|Electricity",unique(whole$variable),fixed = TRUE,value=TRUE)) & model=="AIM/Enduse 3.0" ))


# whole <- rbind(whole, AIM_SE %>% filter(variable %in% intersect(AIM_SE$variable,whole$variable)))
```


```{r input data file}
#  load("~/PROJECTS/CD-LINKS/Database/factsheet/Carbon lock in/Doc/data_IND2019_05_09.RData")
#load("Doc/data_IND2019_08_12.RData")
load("Doc/data_IND2019_12_02.RData")
models <- inline.data.frame(
    'model;                       model.name',
    'REMIND-MAgPIE 1.7-3.0;         REMIND',
    'WITCH2016;          WITCH',
    'AIM/Enduse 3.0;            AIM/Enduse',
    'IMAGE 3.0;     IMAGE',
    'POLES CDL;   POLES',
    'AIM V2.1; AIM',
    'India MARKAL; India MARKAL',
    'GEM-E3; GEM_E3',
    NULL)

## Renaming model names
whole <- whole %>% 
  replace_column(models,model,model.name )%>% 
  order.levels(scen_name=c("Delayed action","Early action")) %>% removeColNa() %>% 
  order.levels(model=c("AIM","IMAGE","POLES","GEM_E3","REMIND","WITCH","AIM/Enduse","India MARKAL"))
## Specific colours for the model names
myColors <- brewer.pal(8,name = "Dark2" ) # for unique colors on models
names(myColors) <- getModels(whole)

# Changing AIM/Enduse SE values for solar and wind based on excel sheet sent by Saritha
#aim_npi_spv <- c(2.25,1.83,30.36, 78.21,520.58, 805.27, 1081.82, 1301.44, 1537.33,1381.79)/1000

# aim_npi_spv <-  c(2.25,1.83,30.36,78.21,984.41,1558.15,1940.17,
# 2229.42,2536.68,2475.69)/1000 # converting from PJ to EJ
# 
# #aim_ndc_spv <- c(2.25,1.83,30.36,81.53,173.53,390.43,618.18,976.08,1366.51,1789.48)/1000
# aim_ndc_spv <- c(2.25,1.83,30.36,81.53,385.54,
# 973.31,1350.24,1881.97,2448.31,3051.37)/1000
# aim_npi_wind <- c(26.96,75.06,138.68,220.33,269.39,337.01,429.57,566.43,
# 617.58,646.49)/1000
# aim_ndc_wind <- c(26.96,75.06,138.68,252.29,331.13,
# 420.48,430.69,565.02,657.00,748.98)/1000
# 
# whole[whole$model=="AIM/Enduse" & whole$variable=="Secondary Energy|Electricity|Solar" & whole$scen_name=="Early action",]$value <- aim_npi_spv
# 
# whole[whole$model=="AIM/Enduse" & whole$variable=="Secondary Energy|Electricity|Solar" & whole$scen_name=="Delayed action",]$value <- aim_ndc_spv
# 
# whole[whole$model=="AIM/Enduse" & whole$variable=="Secondary Energy|Electricity|Wind" & whole$scen_name=="Early action",]$value <- aim_npi_wind
# 
# whole[whole$model=="AIM/Enduse" & whole$variable=="Secondary Energy|Electricity|Wind" & whole$scen_name=="Delayed action",]$value <- aim_ndc_wind

# Changing AIM/Enduse values for Capacity|Solar
whole[whole$model=="AIM/Enduse" & whole$variable=="Capacity|Electricity|Solar",]$value <- whole[whole$model=="AIM/Enduse" & whole$variable=="Capacity|Electricity|Solar",]$value + whole[whole$model=="AIM/Enduse" & whole$variable=="Capacity|Electricity|Storage",]$value

```

```{r input data_2_MIF,eval=FALSE}
# Script to make the the file readable with shiny
whole_1 <- spread(whole,6,10)
whole_1 <- whole_1 %>% select(c(-2,-6,-7))
colnames(whole_1)[5] <- "scenario"
whole_1 <- whole_1[,c(1,5,2,3,4,c(6:25))]
# fwrite(whole_1,file = "CDLINKS_IND_2.mif",sep = ";",quote = FALSE)
fwrite(whole_1,paste0("CDLINKS",Sys.Date(),".mif"),sep=";",quote=FALSE)
```


```{r historical_process_MOINPUT,include=FALSE,eval=FALSE}
# Relevant historical and bottom-up data 
# historical IEA data (PE, SE, FE,Trade), and CEDS emissions data
setConfig(forcecache = TRUE)
historical <- calcOutput("Historical",aggregate = FALSE)# aggregate = TRUE not working at the moment, use when available
historical <- collapseNames(historical,collapsedim = 1)
hist_IEA_CEDS <- as.data.frame(historical) 
hist_IEA_CEDS <- hist_IEA_CEDS[,-1]
# Format "region"   "period"  "model"   "variable" "value"
names(hist_IEA_CEDS)[c(1:5)] <- c("region","period","model","variable","value")
# historical Renewable Energy Capacity data 
IRENA_cap <- readSource("IRENA",subtype = "Capacity")
IRENA_cap <- add_dimension(IRENA_cap,add = "Unit",dim = 3.2,nm = "MW")
IRENA_gen <-  readSource("IRENA",subtype = "Capacity")
IRENA_gen<- add_dimension(IRENA_gen,add = "Unit",dim = 3.2,nm = "GWh")
IRENA <- mbind(IRENA_cap,IRENA_gen)
IRENA <- as.data.frame(IRENA) %>% filter(Region=="IND") %>% select(-1) %>% dplyr::rename(Variable=Data1,Unit=Data2) %>% mutate(model ="IRENA")
names(hist_IRENA_cap) <- names(hist_IEA_CEDS)

# historical data from BP
BP_gen <- readSource("BP",subtype = "Generation") 
BP_gen <- add_dimension(BP_gen,add = "Unit",dim = 3.2,nm = "TWh")
BP_cap <- readSource("BP",subtype = "Capacity")
BP_cap <- add_dimension(BP_cap,add = "Unit",dim = 3.2,nm = "MW")
years <- intersect(getYears(BP_gen),getYears(BP_cap))
BP <- mbind(BP_gen[,years,],BP_cap[,years,])

BP <- as.data.frame(BP) %>% filter(Region=="IND")%>% select(-1) %>% dplyr::rename(Variable=Data1,Unit=Data2) %>% mutate(model ="BP")

# nuclear bottom-up data
nuclear_IAEA <- as.data.frame(calcOutput("CapacityNuclear",aggregate = TRUE))
nuclear_IAEA <- nuclear_IAEA[,-1]
nuclear_IAEA$model <- "IEA"
nuclear_IAEA <- nuclear_IAEA[,c(1,2,5,3,4)]
names(nuclear_IAEA) <- names(hist_IEA_CEDS)
# coal plants bottom up data
coal_EndCoal <- as.data.frame(readSource("EndCoal"))
coal_EndCoal <- coal_EndCoal[,-1]
coal_EndCoal$period <- "2018"
coal_EndCoal$model <- "EndCoal"
coal_EndCoal <- coal_EndCoal[,c(1,2,5,3,4)]
names(coal_EndCoal) <- names(hist_IEA_CEDS)
# coal_EndCoal$value <- as.character(coal_EndCoal$value)
# IEA_WEO 2016 investment costs
capacity_costs_IEA <- as.data.frame(calcOutput("DiffInvestCosts",subtype = "Invest_Costs", aggregate = TRUE))
capacity_costs_IEA <- capacity_costs_IEA[,-1]
capacity_costs_IEA$model <- "IEA_WEO"
capacity_costs_IEA <- capacity_costs_IEA[,c(1,2,5,3,4)]
names(capacity_costs_IEA) <- names(hist_IEA_CEDS)

# bringing all historical and bottom up data together; format- region, Variable Name, Year, Value
hist_and_botmup <- rbind(hist_IEA_CEDS,hist_IRENA_cap,nuclear_IAEA,capacity_costs_IEA,coal_EndCoal) 
hist_and_botmup$scenario <- "historical"
hist_and_botmup <- as.quitte(hist_and_botmup,na.rm = TRUE)
save(hist_and_botmup,file="HistandBotmup.RData")
```

```{r historical_Moinput}
load("Data/HistandBotmup.RData")
```

```{r historical_CEA}
### historical data from various government sources: CEA reports, MNRE, NITI AAYOG
hist_IND <- readxl::read_excel("Data/Compiled_historical.xlsx")
hist_IND <- as.quitte(hist_IND)
```


```{r historical data_MOINPUT_2MIF,eval=FALSE}
hist_IND <- spread(hist_IND,key = period,value = value)
fwrite(hist_IND,file = "hist_IND.mif",sep = ";",quote = FALSE)
```

### Energy sector CO2 emissions
```{r co2 energy emissions}
########## DATA
  whole_emi <- whole[whole$variable=="Emissions|CO2|Energy",] 
# Finding the min and max values for each time-step, required for ribbons

ggplot()+
  geom_line(whole_emi %>%  filter(period %in% c(2010:2050)),mapping = aes(x=period,y=value,group=interaction(modscen,variable),color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  facet_grid(scen_name~.)+
      geom_point(hist_and_botmup %>% filter(region=="IND", period %in% c(2010:2015),variable =="Emi|CO2|Energy (Mt CO2/yr)"),mapping = aes(x=period,y=value,shape=scenario))+
  labs(
    x = "Year" ,
    y = "Emissions from Energy sector (Mt CO2/yr)")+theme_bw()+
  scale_colour_manual(values=myColors)
  


## SAVING FORMAT
# ggsave(filename = "energy_emissions.emf",device = "emf")


```


### Electricity sector emissions
```{r co2 electricity emissions,fig.show='hold',message=FALSE,warning=FALSE}
########### DATA
whole_emi_elec <- whole[whole$variable=="Emissions|CO2|Energy|Supply|Electricity",]

ggplot()+
  geom_line(whole_emi_elec %>%  filter(period %in% c(2010:2050)),mapping = aes(x=period,y=value,group=interaction(modscen,variable),color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  facet_grid(scen_name~.)+theme_bw()+
      geom_point(hist_and_botmup %>% filter(region=="IND", period %in% c(2010:2015),variable =="Emi|CO2|Energy|Supply|Electricity (Mt CO2/yr)"),mapping = aes(x=period,y=value,shape=scenario))+
  labs(
    x = "Year" ,
    y = "Emissions from electricity sector (Mt CO2/yr)" )+
  coord_cartesian(ylim=c(0,2500))+
  scale_colour_manual(values=myColors)
# SAVING
#ggsave(filename = "energy_emissions_1.svg",height=5, width=6,device = "svg")
 
```

### Share of electricity emissions to energy emissions
```{r co2 share of elec_emissions,message=FALSE,,warning=FALSE}
######### DATA
whole_emi <- whole %>% filter(variable %in% c("Emissions|CO2|Energy","Emissions|CO2|Energy|Supply|Electricity"))

whole_emi_share <- calc_addVariable(whole_emi,"Emissions share of electricity" = "`Emissions|CO2|Energy|Supply|Electricity` / `Emissions|CO2|Energy`")

hist_emi <- hist_and_botmup %>% filter(region=="IND", period %in% c(2005:2015),variable %in% c("Emi|CO2|Energy (Mt CO2/yr)","Emi|CO2|Energy|Supply|Electricity (Mt CO2/yr)")) 

hist_emi_share <- calc_addVariable(hist_emi,"Emissions share of electricity" = "`Emi|CO2|Energy|Supply|Electricity (Mt CO2/yr)` / `Emi|CO2|Energy (Mt CO2/yr)`")


ggplot()+
  geom_line(whole_emi_share %>% filter(period %in% c(2010:2050),variable=="Emissions share of electricity"),mapping = aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  facet_grid(scen_name~.)+
  coord_cartesian(ylim=c(0,1))+
  geom_point(hist_emi_share %>% filter(variable=="Emissions share of electricity",period %in% c(2010:2020)),mapping = aes(x=period,y=value,shape=scenario))+
  scale_colour_manual(values=myColors)+
  theme_bw()



```



### Cumulative Emissions 2016-2030
```{r cum_emi,warning=FALSE}
### DATA 
whole_emi_energy <- whole %>% filter(variable=="Emissions|CO2|Energy|Supply|Electricity", period %in% c(2010:2050)) %>% 
  group_by(modscen)

whole_emi_energy <- calcCumulatedDiscount(whole_emi_energy, nameVar = "Emissions|CO2|Energy|Supply|Electricity", discount = 0, fixYear = 2015)

whole_emi_dem_tra <- whole %>%  filter(variable=="Emissions|CO2|Energy|Demand|Transportation",scen_name!="NDC", period %in% c(2010:2050)) %>% 
  group_by(modscen)

whole_emi_dem_tra <- calcCumulatedDiscount(whole_emi_dem_tra, nameVar = "Emissions|CO2|Energy|Demand|Transportation", discount = 0, fixYear = 2015)


whole_emi_dem_ind <- whole %>%  filter(variable=="Emissions|CO2|Energy|Demand|Industry",scen_name!="NDC",period %in% c(2010:2050)) %>% 
  group_by(modscen)


whole_emi_dem_ind <- calcCumulatedDiscount(whole_emi_dem_ind, nameVar = "Emissions|CO2|Energy|Demand|Industry", discount = 0, fixYear = 2015)

whole_emi_dem_res <- whole %>% filter(variable=="Emissions|CO2|Energy|Demand|Residential and Commercial",scen_name!="NDC", period %in% c(2010:2050)) %>% 
  group_by(modscen)


whole_emi_dem_res <- calcCumulatedDiscount(whole_emi_dem_res, nameVar = "Emissions|CO2|Energy|Demand|Residential and Commercial", discount = 0, fixYear = 2015)


whole_cum <- rbind(whole_emi_energy,whole_emi_dem_tra,whole_emi_dem_ind,whole_emi_dem_res) 
 


whole_cum_2 <- whole_cum %>% 
  spread(key = scen_name,value = value) %>% 
  arrange(variable) %>% 
   filter(period!=2010) %>% 
  mutate(`Excess emissions` = `Delayed action` - lead(`Early action`,n = 8,default = `Delayed action`[1])) %>% 
  gather(key = "scen_name",value = "value", c(9:11))

whole_cum_2 <- removeColNa(whole_cum_2)


whole_cum_2$variable <- mip::shorten_legend(whole_cum_2$variable,maxchar = 20,identical_only = TRUE)

ggplot()+
   geom_bar(data=whole_cum_2%>% filter(period==2030), aes(x=scen_name,y=value/1000, fill=variable,group=modscen),position="stack", stat = "identity")+
   labs(
     x = "",
     y = "Cumulative Emissions (2016-2030) (Gt CO2)",
     fill = "Scenario Type",
     alpha = "Model Scope"
   ) +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  facet_grid(~model,scales="free",space = "free_x")+
  theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))





```

### Total Secondary Energy of Electricity
```{r Secondary Energy,warning=FALSE}
# source("plotstyle.R")
plotvar_1 <- c("Secondary Energy|Electricity|Biomass|w/ CCS",
             "Secondary Energy|Electricity|Biomass|w/o CCS",
             "Secondary Energy|Electricity|Other",
             "Secondary Energy|Electricity|Geothermal",
             "Secondary Energy|Electricity|Ocean",
             "Secondary Energy|Electricity|Oil",
             "Secondary Energy|Electricity|Hydro",
             "Secondary Energy|Electricity|Nuclear",
             "Secondary Energy|Electricity|Solar",
             "Secondary Energy|Electricity|Wind",
             "Secondary Energy|Electricity|Gas|w/ CCS",
             "Secondary Energy|Electricity|Gas|w/o CCS",
             "Secondary Energy|Electricity|Coal|w/ CCS",
             "Secondary Energy|Electricity|Coal|w/o CCS")
#### only important fuels
plotvar_2 <- c(#"Secondary Energy|Electricity|Biomass|w/ CCS",
             #"Secondary Energy|Electricity|Biomass|w/o CCS",
             "Secondary Energy|Electricity|Hydro",
             "Secondary Energy|Electricity|Nuclear",
             "Secondary Energy|Electricity|Solar",
             "Secondary Energy|Electricity|Wind",
             "Secondary Energy|Electricity|Gas|w/ CCS",
             "Secondary Energy|Electricity|Gas|w/o CCS",
             "Secondary Energy|Electricity|Coal|w/ CCS",
             "Secondary Energy|Electricity|Coal|w/o CCS",
             NULL)


#whole_se_elec <- whole %>% filter(variable %in% plotvar_1 )
whole_se_elec <- whole %>% filter(variable=="Secondary Energy|Electricity")
### Total Secondary Energy of Electricity by adding all SE techs
whole_se_elec_sum <- whole_se_elec %>% 
  group_by(model, scenario,unit, period,modscen, model_scope, scen_name,region) %>% 
  summarise(value=sum(value)) %>% 
  mutate(variable="Secondary Energy|Electricity")

# Historical SE 
 hist_se_elec_var <- c( "SE|Electricity|Biomass (EJ/yr)",    
    "SE|Electricity|Coal (EJ/yr)" ,      
    "SE|Electricity|Gas (EJ/yr)"    ,    
  "SE|Electricity|Geothermal (EJ/yr)",  "SE|Electricity|Hydro (EJ/yr)" ,     
"SE|Electricity|Oil (EJ/yr)"       ,  "SE|Electricity|Solar (EJ/yr)" ,     
 "SE|Electricity|Nuclear (EJ/yr)"   ,  "SE|Electricity|Wind (EJ/yr)"    )   
hist_se_elec <- hist_and_botmup %>% filter(region=="IND", period %in% c(2005:2015), variable %in% hist_se_elec_var)
# summing up
hist_se_elec_sum <- hist_se_elec %>% 
  group_by(region,period) %>% 
  summarise(value=sum(value))
hist_se_elec_sum$varaible <- "Secondary Energy|Electricity"
hist_se_elec_sum$scenario <- "historical"

ggplot()+
  geom_line(whole_se_elec_sum %>%  filter(period %in% c(2010:2050)),mapping = aes(x=period,y=value,group=interaction(modscen,variable),color=model,linetype=model_scope,size=model_scope))+
   facet_grid(scen_name~.)+theme_bw()+
      geom_point(hist_IND %>% filter(variable=="Secondary Energy|Electricity",model=="MOP",period > 2004) ,mapping = aes(x=period,y=value*0.0036,shape=scenario))+
  labs(
    x = "Year" ,
      y = "Total Secondary Energy of Electricity (EJ/yr)" )+
  scale_size_manual(values=c(1, 1.5))+
  scale_colour_manual(values=myColors)

```
### Secondary Energy Electricity high_carbon
```{r SE_high_carbon,message=FALSE,warning=FALSE}
# source("plotstyle.R")
## high carbon fuels
high_carbon <- c("Secondary Energy|Electricity|Gas|w/o CCS",
                 "Secondary Energy|Electricity|Coal|w/o CCS",
                 "Secondary Energy|Electricity|Oil")
whole_se_elec <- whole %>% filter(variable %in% high_carbon)


####### ADDING HISTORICAL VALUES
whole_se_elec <- whole %>% filter(variable %in% high_carbon)
whole_se_elec <- whole_se_elec %>% 
 add_row(model="GoI",value=3.55,variable="Secondary Energy|Electricity|Coal|w/o CCS",period=2030,scen_name="Early action",model_scope="2017") %>%
 add_row(model="GoI",value=0.18,variable="Secondary Energy|Electricity|Gas|w/o CCS",period=2030,scen_name="Early action",model_scope="2017") %>%   
    add_row(model="GoI",value=3.55,variable="Secondary Energy|Electricity|Coal|w/o CCS",period=2030,scen_name="Delayed action",model_scope="2017") %>%
 add_row(model="GoI",value=0.18,variable="Secondary Energy|Electricity|Gas|w/o CCS",period=2030,scen_name="Delayed action",model_scope="2017") 


#line_type_2(whole_se_elec,hist_se_elec_sum)
# converting EJ to TWh  
whole_se_elec$value <- whole_se_elec$value*277.778
# shortening variable names
whole_se_elec$variable <- mip::shorten_legend(whole_se_elec$variable)
style_hc <- plotstyle(high_carbon)
names(style_hc) <- mip::shorten_legend(names(style_hc))

ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period==2030), aes(x=model,y=value, group=variable,fill=variable), position="stack",stat = "identity")+
  labs(
    x = "Model name" ,
    y = "Generation in 2030 (TWh)",
    fill = "High carbon",
    alpha = "Model Scope"
  ) +
  # theme_bw()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1),axis.text=element_text(size=10), axis.title=element_text(size=14,face="bold"),strip.text.x = element_text(size = 12),strip.text.y = element_text(size = 10))+
   scale_fill_manual(values=style_hc)+
  #scale_alpha_discrete(range = c(0.95, 0.55))
  facet_grid(scen_name~model_scope,scales="free",space = "free_x")+coord_cartesian(ylim=c(0,4000))

ggsave("high_carbon",device = "svg",height=5,width = 6)
```

### Secondary Energy Electrictity low_carbon
```{r SE_low_carbon,message=FALSE,warning=FALSE}
# source("plotstyle.R")
### low carbon fuels
low_carbon <- c("Secondary Energy|Electricity|Coal|w/ CCS",
                 "Secondary Energy|Electricity|Gas|w/ CCS",
                "Secondary Energy|Electricity|Hydro",
                 "Secondary Energy|Electricity|Nuclear",
                 "Secondary Energy|Electricity|Solar",
                 "Secondary Energy|Electricity|Wind",
                "Secondary Energy|Electricity|Biomass|w/o CCS",
                "Secondary Energy|Electricity|Biomass|w/ CCS")

whole_se_elec <- whole %>% filter(variable %in% low_carbon)

# Adding historical data (source Central Electricity Authority and sedon-hand source: Wikipedia article on Electricty in India)
whole_se_elec_2 <- whole_se_elec %>% 
  add_row(model="GoI",value=0.19,variable="Secondary Energy|Electricity|Wind",period=2030,scen_name="Early action",model_scope="2017") %>% 
  add_row(model="GoI",value=0.09,variable="Secondary Energy|Electricity|Solar",period=2030,scen_name="Early action",model_scope="2017") %>% 
  add_row(model="GoI",value=0.471,variable="Secondary Energy|Electricity|Hydro",period=2030,scen_name="Early action",model_scope="2017") %>% 
  add_row(model="GoI",value=0.138,variable="Secondary Energy|Electricity|Nuclear",period=2030,scen_name="Early action",model_scope="2017") %>% 
  add_row(model="GoI",value=0.0549,variable="Secondary Energy|Electricity|Biomass|w/o CCS",period=2030,scen_name="Early action",model_scope="2017") %>%
  add_row(model="GoI",value=0.19,variable="Secondary Energy|Electricity|Wind",period=2030,scen_name="Delayed action",model_scope="2017") %>% 
  add_row(model="GoI",value=0.09,variable="Secondary Energy|Electricity|Solar",period=2030,scen_name="Delayed action",model_scope="2017") %>% 
  add_row(model="GoI",value=0.471,variable="Secondary Energy|Electricity|Hydro",period=2030,scen_name="Delayed action",model_scope="2017") %>% 
  add_row(model="GoI",value=0.138,variable="Secondary Energy|Electricity|Nuclear",period=2030,scen_name="Delayed action",model_scope="2017") %>% 
  add_row(model="GoI",value=0.0549,variable="Secondary Energy|Electricity|Biomass|w/o CCS",period=2030,scen_name="Delayed action",model_scope="2017") %>% 
add_row(model="Nuclear",value=1.25,variable="Secondary Energy|Electricity|Nuclear_NDC",period=2030,scen_name="Delayed action",model_scope="Nuclear") %>% 
     add_row(model="Nuclear",value=0.35,variable="Secondary Energy|Electricity|Nuclear_2023",period=2030,scen_name="Delayed action",model_scope="Nuclear") %>% 
add_row(model="Nuclear",value=1.25,variable="Secondary Energy|Electricity|Nuclear_NDC",period=2030,scen_name="Early action",model_scope="Nuclear") %>% 
     add_row(model="Nuclear",value=0.35,variable="Secondary Energy|Electricity|Nuclear_2023",period=2030,scen_name="Early action",model_scope="Nuclear")
  
whole_se_elec_2 <- whole_se_elec
# converting from EJ to Gwh
whole_se_elec_2$value <- whole_se_elec_2$value*277.778

# shortening legends in data frame
whole_se_elec_2$variable <- mip::shorten_legend(whole_se_elec_2$variable)

# shortening legends in plotstyle for color matching
style_lc <- plotstyle(low_carbon)
names(style_lc) <- mip::shorten_legend(names(style_lc))

###### LOW CARBON

ggplot()+
  geom_bar(data=whole_se_elec_2 %>% filter(period==2030), aes(x=model,y=value, group=variable,fill=variable), position="stack",stat = "identity")+
  labs(
    x = "Model name" ,
    y = "Generation in 2030 (TWh)",
    fill = "Low carbon",
    alpha = "Model Scope"
  ) +
  # theme_bw()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1),axis.text=element_text(size=10), axis.title=element_text(size=14,face="bold"))+
  scale_fill_manual(values=c(Nuclear_NDC="#ff66d9",Nuclear_2023="#ff6666",style_lc))+
  facet_grid(scen_name~model_scope,scales="free",space = "free_x")+coord_cartesian(ylim=c(0,3000))
#ggsave("lowcarbon.svg",device = "svg",height=5,width = 6)
```
### Share of high-C and low-C sources
```{r}
high_carbon <- c("Secondary Energy|Electricity|Gas|w/o CCS",
                 "Secondary Energy|Electricity|Coal|w/o CCS",
                 "Secondary Energy|Electricity|Oil")

solar_wind <- c("Secondary Energy|Electricity|Solar",
                 "Secondary Energy|Electricity|Wind",
                NULL)

other <- c("Secondary Energy|Electricity|Coal|w/ CCS",
                 "Secondary Energy|Electricity|Gas|w/ CCS",
                "Secondary Energy|Electricity|Hydro",
                 "Secondary Energy|Electricity|Nuclear",
               "Secondary Energy|Electricity|Biomass|w/o CCS",
                "Secondary Energy|Electricity|Biomass|w/ CCS")

low_carbon <- c(solar_wind,other)
           
Coal <- c("Secondary Energy|Electricity|Coal|w/ CCS",
          "Secondary Energy|Electricity|Coal|w/o CCS")

Gas <- c("Secondary Energy|Electricity|Gas|w/ CCS",
          "Secondary Energy|Electricity|Gas|w/o CCS")

allVars <- c(high_carbon, solar_wind, other)

whole_se_elec <- whole %>% filter(variable %in% allVars) %>% 
                mutate(value=value*277.778,unit="TWh")  # EJ to TWh
# wholeHighLow <- whole_se_elec %>% mutate(category = if_else(variable %in% high_carbon,"high_carbon","low_carbon")) %>% filter(!is.na(scen_name))
wholeHighLow <- whole_se_elec %>% 
  mutate(category = if_else(variable %in% high_carbon,"Fossil","Low-Carbon")) %>%
  filter(!is.na(scen_name))


#wholeHighLow <- whole_se_elec %>% mutate(category = if_else(variable %in% Coal,"Coal",if_else(variable %in% Gas,"Gas", if_else(variable %in% solar_wind,"Solar + Wind","Other")))) %>% filter(!is.na(scen_name))

# historical data from BP
BPGen <- readSource("BP",subtype = "Generation") 

BP <- as.data.frame(BPGen) %>%
  filter(Region=="IND")%>% 
  select(-1) %>% 
  mutate(model ="2020",model_scope="historical") %>% 
  separate(Data1,into = c("variable","unit"),sep = " ") %>% 
  filter(!variable %in% c("Generation|Electricity|Renewable", "Generation|Electricity")) %>% 
  mutate(variable=gsub(x = variable,pattern = "Generation\\|Electricity",replacement = "Generation")) %>% 
  mutate(category=if_else(variable %in% c("Generation|Coal", "Generation|Gas", "Generation|Oil"), "Fossil", "Low-Carbon"))


# BP <- BP %>% 
#   mutate(category = if_else(variable == "Generation|Coal", "Coal", if_else(variable == "Generation|Gas", "Gas", if_else(variable %in% c("Generation|Solar","Generation|Wind"), "Solar + Wind","Other"))))



colnames(BP) <- c("region","year","variable","unit","value","model","model_scope","category")

p <- ggplot()+
  geom_bar(wholeHighLow %>% filter(period == 2030, scen_name == "Delayed action"),mapping = aes(x = model, y = value, fill = category), stat = "identity", position = "fill")+
  geom_bar(BP %>% filter(year == 2019), mapping = aes(x = model, y = value, fill = category), position = "fill", stat="identity")+
  theme(axis.text.x = element_text(angle = 90, hjust = 1), 
        axis.text = element_text(size = 12), axis.title = element_text(size=14,face="bold"),
        legend.text = element_text(size=14),
        strip.text = element_text(size = 14))+
   facet_grid(scen_name~factor(model_scope,levels = c("historical","global","national")),scales="free",space = "free_x")+
  scale_fill_manual(values=c("Fossil"="#0c0c0c", 
                            # "Gas"="#999959",
                             "Low-Carbon"="#ffcc00",
                             NULL))+
   labs(x="",y="",title = "Share of generation by technology in 2030")+
  scale_size_manual(values=c(1, 1.5))+
  geom_hline(yintercept = 0.22, linetype=2)+
  geom_hline(yintercept = 0.32,color="red",  linetype=2)
  


ggsave("share_generation_2030.png",device = "png")


```

### Boxplot change in solar, wind, and coal
```{r}
vars <- c("Secondary Energy|Electricity|Coal|w/o CCS",
          "Secondary Energy|Electricity|Solar",
          "Secondary Energy|Electricity|Wind",
          "Secondary Energy|Electricity|Hydro",
          "Secondary Energy|Electricity|Nuclear",
          "Secondary Energy|Electricity|Gas|w/o CCS",
          "Secondary Energy|Electricity",
          NULL)

style_lc <- mip::plotstyle(vars)
names(style_lc) <-gsub(names(style_lc),pattern = "Secondary Energy\\|Electricity\\|",replacement = "")

names(style_lc) <-gsub(names(style_lc),pattern = "Secondary Energy\\|",replacement = "Total ")
style_lc[7] <- "#cc0000"
#CEA - (1259000-1115237)/1115237 = 13%
#IEM - (1450000-1125000)/1125000 = 
#IESS - (1702000-1115237)/1115237 = 52.6 %

#histINDfilter <- hist_IND %>% filter(period>2017)

whole_se_coal <- whole %>%
  filter(variable %in% vars, period %in% c(2020, 2030)) %>% 
  mutate(value = value*277.778,unit="TWh") %>% 
  spread(period, value = value) %>% 
  mutate(change = ((`2030`-`2020`)/`2020`)*100) %>% 
  select(model, variable, model_scope, scen_name, change) %>% 
  mutate(variable = gsub(variable, pattern = "Secondary Energy\\|Electricity\\|", replacement = "")) %>% 
  mutate(variable = gsub(variable, pattern = "Secondary Energy\\|", replacement = "Total ")) %>% 
  mutate(variable = factor(variable, levels = c("Total Electricity","Coal|w/o CCS", "Gas|w/o CCS", "Hydro", "Nuclear", "Solar", "Wind")))

## PLOTTING
p <- ggplot(whole_se_coal %>% filter(scen_name == "Delayed action"))+
  geom_boxplot( mapping = aes(x = variable,y = change, fill = variable),show.legend = FALSE)+
  geom_point(mapping = aes(x=variable,y=change,shape=model_scope),size=3)+
 # facet_grid(~model_scope)+
 scale_shape_manual(values = c("global" = 1, "national" = 8))+
  theme_bw(base_size = 14)+
  scale_fill_manual(values = c(style_lc),guide = "none")+
  labs(x="", y="Change in generation, 2030 relative to 2020 (%)",subtitle = "Following NDC policies")+
  theme(text = element_text(size = 16),
        legend.title=element_blank(),
        legend.position = c(0.1,0.8),
        NULL)+
  scale_size_manual(values=c(1, 1.5))
  #coord_cartesian(ylim=c(-50,900))

medianVal <-  whole_se_coal %>% 
    group_by(variable,scen_name) %>% 
  summarise(medianVal=median(change)) %>% 
  spread(scen_name,value = "medianVal")


q <- ggplot()+
  geom_point(medianVal,mapping = aes(x=`Delayed action`,y=`Early action`,color=variable), size = 3)+
  geom_abline(slope = 1, linetype = 2)+
   scale_color_manual(values = c(style_lc))+
  coord_cartesian(ylim=c(-50,300),xlim=c(-50,300))+
  labs(x="Delayed action change (%), 2030 relative to 2020 (median)",
       y ="Early action change (%), 2030 relative to 2020 (median)")+
  theme_bw()+
  theme(text = element_text(size = 14))
        


```




### Capacity solar
```{r cap solar, message=FALSE,warning=FALSE}
whole_cap_solar <- whole %>% filter(variable %in% c("Capacity|Electricity|Solar" ))

whole_cap_solar_1 <- whole_cap_solar %>% 
    filter(scen_name=="Delayed action") %>% 
  group_by(modscen,scen_name) %>% 
  as.data.frame()

whole_cap_solar_2 <- whole_cap_solar %>% 
  filter(scen_name=="Early action") %>% 
  group_by(modscen,scen_name) %>% 
  as.data.frame()

try_bl <- bind_cols(whole_cap_solar_1,whole_cap_solar_2) %>% 
group_by(model,period)%>%
  mutate(difference=value1-value)

try_bl <- try_bl[,c(1:8,21)] 
try_bl$scen_name <- "difference"
names(try_bl)[9] <- "value"

whole_cap_solar_3 <- bind_rows(whole_cap_solar,try_bl) 
whole_cap_solar_3 <-  factor.data.frame(whole_cap_solar_3)%>%
order.levels(scen_name = c("Delayed action","Early action","difference")) 

ggplot()+
  geom_line(data = whole_cap_solar_3 %>% filter(period<2051,scen_name %in% c("Delayed action","Early action")), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
  facet_grid(scen_name~.)+
  scale_size_manual(values=c(1, 1.5))+
 labs(
    x = "Year",
    y = "Capacity|Electricity|Solar (GW)"
    )+
  coord_cartesian(ylim=c(0,500))+
   geom_point(hist_IND %>% filter(variable=="Capacity|Electricity|Solar",model %in% c("CEA_MON","CEA_ANNUAL","CEA_NEP"),period %in% c(2015:2027)),mapping = aes(x=period,y=value/1000,shape=scenario))+
  scale_colour_manual(values=myColors)

ggplot()+
  geom_line(data = whole_cap_solar_3 %>% filter(period<2051), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
  facet_grid(scen_name~.)+
  scale_size_manual(values=c(1, 1.5))+
 labs(
    x = "Year",
    y = "Capacity|Electricity|Solar (GW)"
    )+
  coord_cartesian(ylim=c(0,500))
              
```
### Secondary Energy Solar
```{r SE Solar,message=FALSE,warning=FALSE}
whole_se_solar <- whole %>% filter(variable %in% c("Secondary Energy|Electricity|Solar" ))

whole_se_solar_global <- whole_se_solar%>% 
  filter(period<2051,model_scope=="global",scen_name=="Delayed action",model!="GEM_E3") %>% 
  group_by(period) %>% 
  summarise(minimum=min(value)*277.78,maximum=max(value)*277.78)
## Without ribbons
ggplot()+
  geom_line(data = whole_se_solar %>% filter(period %in% c(2010:2030),scen_name=="Delayed action"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
 # facet_grid(scen_name~.)+
  scale_size_manual(values=c(1, 1.5))+
  #coord_cartesian(ylim=c(0,1.5))+
  labs(
    x = "Year",
    y = "Power generation from solar (TWh)"
    )+
  geom_point(hist_IND%>% filter(variable=="Secondary Energy|Electricity|Solar",model %in% c("CEA_MON","CEA_ANNUAL","CEA_NEP","Prayas"),period %in% c(2015:2027)),mapping = aes(x=period,y=value,shape=scenario))+
  scale_colour_manual(values=myColors)+theme_bw()+
  theme(axis.title=element_text(size=12))

# With ribbons
ggplot()+
  geom_line(data = whole_se_solar %>% filter(period %in% c(2010:2030),scen_name=="Delayed action",model_scope=="global"), mapping = aes(x=period,y=value*277.78,group=interaction(model,scen_name)),size=0.1,color="grey")+
  geom_ribbon(whole_se_solar_global %>% filter(period %in% c(2010:2030)),mapping = aes(x =period,ymin = minimum,ymax=maximum), alpha = 0.4,fill="grey")+
  geom_line(data = whole_se_solar %>% filter(period %in% c(2010:2030),scen_name=="Delayed action",model_scope=="national"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model),size=1.5,linetype=2)+
 # facet_grid(scen_name~.)+
  #scale_size_manual(values=c(1, 1.5))+
  #coord_cartesian(ylim=c(0,350))+
  labs(
     #x = "Year",
    y = "Power generation from solar (TWh)"
    )+
  geom_point(hist_IND%>% filter(variable=="Secondary Energy|Electricity|Solar",model %in% c("CEA_MON","CEA_ANNUAL","CEA_NEP","Prayas"),period %in% c(2010:2027)),mapping = aes(x=period,y=value,shape=scenario))+
  scale_colour_manual(values=myColors)+
  theme_bw()+
  theme(axis.title=element_text(size=14),axis.text = element_text(size=12),axis.title.x=element_blank())+
  geom_text(whole_se_solar %>% filter(period ==2030,scen_name=="Delayed action",model_scope=="global") %>% mutate (short_name= substring(model,1,1)) ,mapping = aes(x=2030.5,y=value*277.78,label=short_name,fontface="bold"),color="grey",size=3.5)+
  coord_cartesian(ylim=c(0,460))
  

```
### Secondary Energy Wind
```{r SE Wind,message=FALSE,warning=FALSE}
whole_se_wind <- whole %>% filter(variable %in% c("Secondary Energy|Electricity|Wind" ))

whole_se_wind_global <- whole_se_wind%>% 
  filter(period<2051,model_scope=="global",scen_name=="Delayed action",model!="GEM_E3") %>% 
  group_by(period) %>% 
  summarise(minimum=min(value)*277.78,maximum=max(value)*277.78)

# without ribbons
ggplot()+
  geom_line(data = whole_se_wind %>% filter(period %in% c(2010:2030),scen_name=="Delayed action"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
 # facet_grid(scen_name~.)+
  scale_size_manual(values=c(1, 1.5))+
  #coord_cartesian(ylim=c(0,1.5))+
  labs(
    x = "Year",
    y = "Power generation from wind (TWh)"
    )+
  geom_point(hist_IND%>% filter(variable=="Secondary Energy|Electricity|Wind",model %in% c("CEA_ANNUAL","CEA_NEP"),period %in% c(2015:2027)),mapping = aes(x=period,y=value,shape=scenario))+
  scale_colour_manual(values=myColors)+theme_bw()+
  theme(axis.title=element_text(size=12))

# with ribbons
ggplot()+
  geom_line(data = whole_se_wind %>% filter(period %in% c(2010:2030),
    scen_name=="Delayed action",model_scope=="global"),     mapping = aes(x=period,y=value*277.78,group=interaction(model,scen_name)),
    size=0.1,color="grey")+
   geom_ribbon(whole_se_wind_global %>% filter(period %in% c(2010:2030)),mapping = aes(x =period,ymin = minimum,ymax=maximum),alpha = 0.4,fill="grey")+
  geom_line(data = whole_se_wind %>% filter(period %in% c(2010:2030),scen_name=="Delayed action",model_scope=="national"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model),size=1.5,linetype=2)+
  
 # facet_grid(scen_name~.)+
  #scale_size_manual(values=c(1, 1.5))+
  #coord_cartesian(ylim=c(0,350))+
  labs(
    x = "Year",
    y = "Power generation from wind (TWh)"
    )+
  geom_point(hist_IND%>% filter(variable=="Secondary Energy|Electricity|Wind",model %in% c("CEA_MON","CEA_ANNUAL","CEA_NEP"),period %in% c(2015:2027)),mapping = aes(x=period,y=value,shape=scenario))+
  scale_colour_manual(values=myColors)+theme_bw()+
  theme(axis.title=element_text(size=14),axis.text = element_text(size=12),      axis.title.x=element_blank())+
    geom_text(whole_se_wind %>% filter(period ==2030,
  scen_name=="Delayed action",model_scope=="global")
  %>% mutate (short_name= substring(model,1,1)), 
  mapping = aes(x=2030.5,y=value*277.78, 
 label=short_name,fontface="bold"),color="grey",size=3.5)+
  coord_cartesian(ylim=c(0,460))

    
 

```


### Capacity Wind
```{r Capacity Wind,message=FALSE,error=FALSE}
whole_cap_wind <- whole %>% filter(variable %in% c("Capacity|Electricity|Wind" ))

whole_cap_wind_1 <- whole_cap_wind %>% 
    filter(scen_name=="Delayed action") 


whole_cap_wind_2 <- whole_cap_wind %>% 
  filter(scen_name=="Early action") 

try_bl <- bind_cols(whole_cap_wind_1,whole_cap_wind_2) %>% group_by(model,period)%>%
  mutate(difference=value1-value) %>% ungroup()

try_bl <- try_bl[,c(1:8,21)] 
try_bl$scen_name <- "difference"
names(try_bl)[9] <- "value"

whole_cap_wind_3 <- bind_rows(whole_cap_wind,try_bl)
whole_cap_wind_3 <-  factor.data.frame(whole_cap_wind_3)%>%
order.levels(scen_name = c("Delayed action","Early action","difference"))

ggplot()+
  geom_line(data = whole_cap_wind_3 %>% filter(period %in% c(2010:2050),scen_name %in% c("Delayed action","Early action")), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
  facet_grid(scen_name~.)+
  scale_size_manual(values=c(1, 1.5))+
 labs(
    x = "Year",
    y = "Capacity|Electricity|Wind (GW)"
    )+
  coord_cartesian(ylim=c(0,500))+
   geom_point(hist_IND %>% filter(variable=="Capacity|Electricity|Wind",model %in% c("CEA_MON","CEA_ANNUAL","CEA_NEP"),period %in% c(2015:2027)),mapping = aes(x=period,y=value/1000,shape=scenario))+
  scale_colour_manual(values=myColors)

ggplot()+
  geom_line(data = whole_cap_wind_3 %>% filter(period %in% c(2010:2050)), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
  facet_grid(scen_name~.)+
  scale_size_manual(values=c(1, 1.5))+
 labs(
    x = "Year",
    y = "Capacity|Electricity|Wind(GW)"
    )+
  coord_cartesian(ylim=c(0,500))+
  scale_colour_manual(values=myColors)
              

              
  
```

### Secondary Energy coal
```{r SE_coal, message=FALSE,warning=FALSE}

whole_se_elec_coal <- whole %>% filter(variable %in% c("Secondary Energy|Electricity|Coal|w/o CCS")) 


hist_se_elec_coal <- hist_and_botmup %>% filter(region=="IND", period %in% c(2005:2015),  variable=="SE|Electricity|Coal (EJ/yr)")


whole_se_elec_coal_1 <- whole_se_elec_coal %>% 
    filter(scen_name=="Delayed action") %>% 
  group_by(modscen,scen_name)

whole_se_elec_coal_2 <- whole_se_elec_coal %>% 
  filter(scen_name=="Early action") %>% 
  group_by(modscen,scen_name)

try_bl <- bind_cols(whole_se_elec_coal_1,whole_se_elec_coal_2) %>% group_by(model,period)%>%
  mutate(difference=value-value1)

try_bl <- try_bl[,c(1:8,21)] 
try_bl$scen_name <- "difference"
names(try_bl)[9] <- "value"

#IND_proj <- data.frame(period=c(2022,2027),value=c(((217.302+32.5)*0.565*8760)/(277777.78),((238.150+39)*0.605*8760)/(277777.78)))
#IND_proj$type <- "CEA_projections"

whole_se_elec_coal_3 <- bind_rows(whole_se_elec_coal,try_bl)



whole_se_elec_coal_3 <- 
  factor.data.frame(whole_se_elec_coal_3)%>%
order.levels(scen_name = c("Delayed action","Early action","difference"))

whole_se_elec_coal_global <- whole_se_elec_coal%>% 
  filter(period<2051,scen_name=="Delayed action",model!="GEM_E3") %>% 
  group_by(period,model_scope) %>% 
  summarise(minimum=min(value)*277.78,maximum=max(value)*277.78)

# Without ribbons
ggplot()+
  geom_line(data = whole_se_elec_coal_3 %>% filter(scen_name=="Early action"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
 #facet_grid(scen_name~.)+
  scale_size_manual(values=c(1, 1.5))+
 labs(
   # x = "Year",
    y = "Power generation from coal w/o CCS (TWh)",
    subtitle = "Early action"
    )+ theme(strip.text.x = element_text(size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  scale_colour_manual(values=myColors)+theme_bw()+
   theme(axis.title=element_text(size=12),axis.text = element_text(size=10),
        axis.title.x=element_blank())+
  coord_cartesian(xlim = c(2010,2030))+
     geom_point(hist_IND %>% filter(variable=="Secondary Energy|Electricity|Coal",model %in% c("CEA_growth","CEA_NEP","IESS","IEM")),mapping = aes(x=period, y= value*0.001,shape=scenario))
  

# With ribbons
ggplot()+
  geom_line(data = whole_se_elec_coal_3 %>% filter(period %in% c(2010:2030),scen_name=="Delayed action",model_scope=="global"), aes(x=period,y=value*277.78,group=interaction(model,scen_name)),size=0.1,color="grey")+
   geom_ribbon(whole_se_elec_coal_global %>% filter(period %in% c(2010:2030),model_scope=="global"),mapping = aes(x =period,ymin = minimum,ymax=maximum,fill=model_scope),
              alpha = 0.5,fill="grey")+
  geom_line(data = whole_se_elec_coal_3 %>% filter(period %in% c(2010:2030),scen_name=="Delayed action",model_scope=="national"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model),linetype=2,size=1.5)+
 #facet_grid(scen_name~.)+
  scale_size_manual(values=c(1.5, 2.5))+
 labs(
   # x = "Year",
    y = "Power generation from coal w/o CCS (TWh)"
    )+ theme(strip.text.x = element_text(size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  scale_colour_manual(values=myColors)+
  theme_bw()+
   theme(axis.title=element_text(size=12),axis.text = element_text(size=10),
        axis.title.x=element_blank())+
     geom_point(hist_IND %>% filter(variable=="Secondary Energy|Electricity|Coal",model %in% c("CEA_growth","CEA_NEP","IESS","IEM","CEA_OPT")),mapping = aes(x=period, y= value*0.001,shape=model,size=scenario))+
 # coord_cartesian(xlim = c(2010,2030))+
  geom_text(whole_se_elec_coal_3 %>% filter(period ==2030, scen_name=="Delayed action", model_scope=="global")%>% mutate (short_name= substring(model,1,1)), mapping = aes(x=2030.5, y=value*277.78,                label=short_name,fontface="bold"),color="grey",size=3)
 
  
```
  
  ### Quantification of additional pre-retirement
```{r,eval=FALSE}
whole_slice <- whole %>% filter(scen_name!="NDC",period>2019,variable=="Secondary Energy|Electricity|Coal|w/o CCS")

whole_slice_2 <- whole_slice %>% filter(period %in% c(2020,2030),scen_name=="Delayed action")

whole_slice_2_sp <- spread(data = whole_slice_2,key = c(6,8),value = value) 

whole_slice_3 <- whole_slice %>% filter(period %in% c(2030,2020)) %>% spread(6,value=value) %>% mutate((`2030`-`2020`))

```

### Capacity Hydro
```{r}
whole_cap_elec_hydro <- whole %>% filter(variable %in% c("Capacity|Electricity|Hydro")) 


ggplot()+
  geom_line(data = whole_cap_elec_hydro %>% filter(period %in% c(2005:2050)), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
   facet_grid(scen_name~.)+
 labs(
    x = "Year",
    y = "Capacity|Electricity|Hydro (GW)"
    )+ theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
     geom_point(hist_IND %>% group_by(model,variable) %>% filter(variable=="Capacity|Electricity|Hydro",model=="CEA_ANNUAL",period%in%c(2005:2018)),mapping = aes(x=period, y= value/1000,shape=scenario))+
  scale_colour_manual(values=myColors)

```

### Secondary Energy Hydro
```{r SE Hydro}
whole_sec_elec_hydro <- whole %>% filter(variable %in% c("Secondary Energy|Electricity|Hydro")) 

ggplot()+
  geom_line(data = whole_sec_elec_hydro %>% filter(period %in% c(2005:2030),scen_name=="Delayed action"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
# facet_grid(scen_name~.)+
 labs(
    x = "Year",
    y = "Power generation from Hydro (TWh)"
    )+ theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
     geom_point(hist_IND %>% group_by(model,variable) %>% filter(variable=="Secondary Energy|Electricity|Hydro", model %in% c("CEA_NEP","OWN"), period%in%c(2005:2027)),mapping = aes(x=period, y= value*0.001,shape=scenario))+
  scale_size_manual(values=c(1, 1.5))+theme_bw()+
  scale_colour_manual(values=myColors)
  #coord_cartesian(xlim = c(2010,2030))
```

### Seconday Energy gas
```{r SE_gas,message=FALSE,warning=FALSE}
# SE|Gas|Electricity
whole_se_elec_gas <- whole %>% filter(variable %in% c("Secondary Energy|Electricity|Gas|w/o CCS"))

whole_se_elec_gas_2 <- whole_se_elec_gas%>% 
  filter(period<2051,model_scope=="global",scen_name=="Delayed action") %>% 
  group_by(period) %>% 
  summarise(minimum=min(value)*277.78,maximum=max(value)*277.78)
# without ribbons
ggplot()+
  geom_line(data =whole_se_elec_gas %>% filter(period <2035,scen_name=="Delayed action"), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  #facet_grid(scen_name~.)+
  geom_point(hist_IND %>% filter(variable=="Secondary Energy|Electricity|Gas",model%in% c("NITI AAYOG",
"CEA_NEP")),mapping = aes(x = period,y=value*0.001,shape=scenario))+
 labs(x = "Year",
    y = " Power generation from gas (TWh)" )+ theme_bw()+
  #coord_cartesian(xlim=c(2005,2030),ylim = c(0,3) )+
  scale_colour_manual(values=myColors)


# with ribbons
ggplot()+
   geom_line(data = whole_se_elec_gas %>% filter(period %in% c(2010:2030),
    scen_name=="Delayed action",model_scope=="global"),     mapping = aes(x=period,y=value*277.78,group=interaction(model,scen_name)),
    size=0.1,color="grey")+
   geom_ribbon(whole_se_elec_gas_2 %>% filter(period %in% c(2010:2030)),mapping = aes(x =period,ymin = minimum,ymax=maximum),
              alpha = 0.4,fill="grey")+
  geom_line(data =whole_se_elec_gas %>% filter(period %in% c(2010:2030),scen_name=="Delayed action",model_scope=="national"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model),linetype="dashed",size=1.5)+
  #scale_size_manual(values=c(1, 1.5))+
  #facet_grid(scen_name~.)+
  geom_point(hist_IND %>% filter(variable=="Secondary Energy|Electricity|Gas",model%in% c("NITI AAYOG",
"CEA_NEP")),mapping = aes(x = period,y=value*0.001,shape=scenario))+
 labs(x = "Year",
    y = " Power generation from gas (TWh)" )+ theme_bw()+
  #coord_cartesian(xlim=c(2005,2030),ylim = c(0,3) )+
  scale_colour_manual(values=myColors)+
   theme(axis.title=element_text(size=12),axis.text = element_text(size=10),
        axis.title.x=element_blank())+
  geom_text(whole_se_elec_gas %>% filter(period ==2030,
  scen_name=="Delayed action",model_scope=="global")
  %>% mutate (short_name= substring(model,1,1)), 
  mapping = aes(x=2030.3,y=value*277.78,                 label=short_name,fontface="bold"),color="grey",size=3)
  
  

# ggsave("elec_gas.svg",device = "svg",height=5,width = 6)


```
### Share of solar and wind in generation
```{r VRE_share,message=FALSE,warning=FALSE,eval=FALSE}
### all tech
plotvar_1 <- c("Secondary Energy|Electricity|Biomass|w/ CCS",
             "Secondary Energy|Electricity|Biomass|w/o CCS",
             "Secondary Energy|Electricity|Other",
             "Secondary Energy|Electricity|Geothermal",
             "Secondary Energy|Electricity|Ocean",
             "Secondary Energy|Electricity|Oil",
             "Secondary Energy|Electricity|Hydro",
             "Secondary Energy|Electricity|Nuclear",
             "Secondary Energy|Electricity|Solar",
             "Secondary Energy|Electricity|Wind",
             "Secondary Energy|Electricity|Gas|w/ CCS",
             "Secondary Energy|Electricity|Gas|w/o CCS",
             "Secondary Energy|Electricity|Coal|w/ CCS",
             "Secondary Energy|Electricity|Coal|w/o CCS")

whole_se_elec <- whole %>% filter(variable %in% plotvar_1)
### Total Secondary Energy of Electricity by adding all SE techs
whole_se_elec_sum <- whole_se_elec %>% 
  group_by(model, scenario,unit, period,modscen, model_scope, scen_name,region) %>% 
  summarise(value=sum(value)) %>% 
  mutate(variable="Secondary Energy|Electricity")

## only renewable
plotvar_2 <- c("Secondary Energy|Electricity|Solar",
             "Secondary Energy|Electricity|Wind")
whole_se_elec_sw <- whole %>% filter(variable %in% plotvar_2 )

# whole_se_elec_sw[whole_se_elec_sw$model=="AIM/Enduse",]$value <- whole_se_elec_sw[whole_se_elec_sw$model=="AIM/Enduse",]$value/3

whole_se_elec_sum <- whole_se_elec %>% 
  group_by(model, scenario,unit, period,modscen, model_scope, scen_name,region) %>% 
  summarise(value=sum(value)) %>% 
  mutate(variable="Secondary Energy|Electricity")

# whole_se_elec_sum[whole_se_elec_sum$model=="AIM/Enduse",]$value <- whole_se_elec_sum[whole_se_elec_sum$model=="AIM/Enduse",]$value/3

whole_se_elec_sw_sum <- whole_se_elec_sw %>% 
  group_by(model, scenario,unit, period,modscen, model_scope, scen_name,region) %>% 
  summarise(value=sum(value)) %>% 
  mutate(variable="Secondary Energy|Electricity|Solar_Wind")

whole_se_elec_combined <- bind_rows(whole_se_elec_sw_sum,whole_se_elec_sum) %>% 
  group_by(period,modscen)
# whole_se_elec_combined <- as.quitte(whole_se_elec_combined)

whole_se_elec_combined <- spread(whole_se_elec_combined %>% 
  group_by(period,modscen),key = variable,value = value) %>% 
  mutate(share=`Secondary Energy|Electricity|Solar_Wind`/`Secondary Energy|Electricity`) %>% 
  gather(value,key = variable,9:11)

ggplot()+
  geom_line(data = whole_se_elec_combined %>% filter(period<2031,variable=="share"), aes(x=as.factor(period),y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  facet_grid(.~scen_name)+
 labs(
    x = "Year",
    y = "Share of solar and wind to total generation"
    )+
  scale_colour_manual(values=myColors)
  
```

### Secondary Energy by all sourcess
```{r}
whole_se_elec <- whole %>% filter(variable %in% plotvar_2 )

whole_se_elec_del <- whole_se_elec %>% 
    filter(scen_name=="Delayed action") 

whole_se_elec_ear <- whole_se_elec %>% 
  filter(scen_name=="Early action") 

whole_se_elec_diff <- bind_cols(whole_se_elec_del,whole_se_elec_ear) %>% group_by(model,period)%>%
  mutate(difference=value1-value) 

whole_se_elec_diff <- whole_se_elec_diff[,c(1:8,21)] 
whole_se_elec_diff$scen_name <- "difference"
names(whole_se_elec_diff)[9] <- "value"

whole_se_elec_all <- bind_rows(whole_se_elec,whole_se_elec_diff) %>% 
  order.levels(scen_name=c("Delayed action","Early action","difference"))

#whole_se_elec_all <- character.data.frame(whole_se_elec_all)
#whole_se_elec_all$scen_name <- as.ordered(x = c("Delayed action","Early action","Difference"))

# whole_se_elec_all$variable <- shorten_legend(whole_se_elec_all$variable)
# 
# shortName_ps <- plotstyle(unique(whole_se_elec_all$variable))
# names(shortName_ps) <- shorten_legend(names(shortName_ps))
hist_generation <- read_excel("~/PROJECTS/CD-LINKS/Database/factsheet/Carbon lock in/hist_generation.xlsx")
whole_se_elec_all <- rbind(whole_se_elec_all,hist_generation)

ggplot()+
  geom_bar(data=whole_se_elec_all %>% filter(period==2030)  ,  aes(x=scen_name,y=value*277.78,group=variable,fill=variable),position = "stack",stat = "identity")+
  facet_grid(.~model,labeller =label_wrap_gen(6,multi_line = TRUE))+
    theme(strip.text.x = element_text(size = 6),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(
    x="Scenario",
    y = "Power Generation in 2030 (TWh) ")+
   scale_fill_manual(values=mip::plotstyle(plotvar_2))
  
```

```{r SE shares,error=FALSE,message=FALSE}
##### SE SHARES
ggplot(data=whole_se_elec %>% filter(period %in% c(2030)))+
  geom_bar(aes(x=as.factor(period),y=value,group=variable,fill=variable),position = "fill",stat = "identity")+
    scale_fill_manual(values=mip::plotstyle(whole_se_elec$variable))+
  facet_grid(scen_name~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(x="Period",
    y = "Secondary Energy shares in 2030")
```

```{r}
#### WITH FACET GRID ON NATIONAL AND GLOBAL  FOR DELAYED ACTION
ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period==2030,scen_name=="Delayed action") , aes(x=model,y=value, group=variable,fill=variable),position="fill", stat = "identity",width = 0.5)+
  labs(
    x = "Model name" ,
    y = "Share in Generation (2030)",
    fill = "Scenario Type",
    alpha = "Model Scope"
  ) +
  # theme_bw()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
   scale_fill_manual(values=mip::plotstyle(plotvar_1))+
  #scale_alpha_discrete(range = c(0.95, 0.55))
  facet_grid(~model_scope,scales="free",space = "free_x")+geom_hline(yintercept = 0.4)

```
```{r}
#### WITH FACET GRID ON NATIONAL AND GLOBAL  FOR EARLY ACTION
ggplot()+
  geom_bar(data=whole_se_elec %>% filter(period==2030,scen_name=="Early action") , aes(x=model,y=value, group=variable,fill=variable),position="fill", stat = "identity",width = 0.5)+
  labs(
    x = "Model name" ,
    y = "Share in Generation (2030)",
    fill = "Scenario Type",
    alpha = "Model Scope"
  ) +
  # theme_bw()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
   scale_fill_manual(values=mip::plotstyle(plotvar_1))+
  #scale_alpha_discrete(range = c(0.95, 0.55))
  facet_grid(~model_scope,scales="free",space = "free_x")

```

```{r}

### SEPERATING NATIONAL AND GLOBAL
ggplot()+
  geom_bar(data=whole_se_elec %>% filter (period== 2030,scen_name!="NDC" ), aes(x=as.factor(period),y=value,group=interaction(model_scope,variable),fill=variable),position = "fill",stat = "identity")+
    scale_fill_manual(values=mip::plotstyle(plotvar_1))+
  facet_grid(scen_name~model)+
    theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(x="Period",
    y = "Secondary Energy shares in 2030")+
    scale_fill_manual(values=mip::plotstyle(plotvar_1))+
  facet_grid(scen_name~model)
  
```

### Emissions Intensity
```{r,message=FALSE,warning=FALSE}
#### CO2 per GWh"
# whole_emi_elec <- whole[whole$variable=="Emissions|CO2|Energy|Supply|Electricity",]
# whole_emi_elec <- whole_emi_elec %>%  arrange(modscen)
# 
# try_1 <- whole_se_elec_sum
# try_1$value <- (try_1$value*277777.78) # converting EJ to GWh
# 
# try_1 <- try_1 %>% arrange(modscen)
# 
# try_1 <- transform(try_1,emissionsperGwh=((whole_emi_elec$value)*1000)/try_1$value )# emissions are in MtCO2
# 
# try_1$variable <- "Emissions Intensity"
# try_1$unit <- "kgCO2/kWh"
# try_1$value <- try_1$emissionsperGwh
# 
# try_2 <- hist_se_elec_sum
# try_2$value <- (try_2$value*277777.78) # converting EJ to GWh
# try_2 <- transform(try_2,emissionsperGwh=((hist_emi_elec$value)*1000)/try_2$value )# emissions are in MtCO2
# try_2$value <- try_2$emissionsperGwh
# 
# 
# line_type_2(try_1 %>% filter(!scen_name %in% c("Delayed action"),model_scope=="global"),try_2)+ coord_cartesian(xlim=c(2005,2050),ylim=c(0,1))+ labs(y="Emissions Intensity (kgCO2/kWh)",x="Year")+theme(axis.text=element_text(size=12), axis.title=element_text(size=13,face="bold"),legend.position="none")
#   
#   
#   
#   theme(axis.text=element_text(size=12), axis.title=element_text(size=14,face="bold"))
# 
# line_type_2(try_1 %>% filter(!scen_name %in% c("Early action","Delayed action")),try_2)
# ggsave("emissions_intensity.svg",device = "svg",height=5,width = 6)
```
### Final Energy of Electricity
```{r FE_Electricity}
######### DATA

whole_fe_elec <- whole %>% filter(variable=="Final Energy|Electricity")

# Historical FE
hist_fe_elec <- hist_and_botmup %>% filter(region=="IND", period %in% c(2005:2015),variable =="FE|Electricity (EJ/yr)") 

############ PLOTS


ggplot()+
  geom_line(data = whole_fe_elec %>% filter(period %in% c(2010:2050),scen_name=="Delayed action"), aes(x=period,y=value*277.78,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
#  facet_grid(scen_name~.)+
 labs(x = "Year",
    y = "Final Energy of Electricity (TWh)",
    title = "Delayed action")+
  theme_bw()+
geom_point(hist_IND %>% filter(variable=="Final Energy|Electricity",model %in% c("CEA_growth","CEA_EXEC")),mapping = aes(y=value*0.001,x=period,shape=scenario))+
 scale_size_manual(values=c(1, 1.5))+
  scale_colour_manual(values=myColors)

ggplot()+
  geom_bar(data = whole_fe_elec %>% filter(period==2035), aes(x=model,y=value,group=interaction(model,scen_name),fill=scen_name),position = "dodge",stat = "identity")+coord_flip()
  #facet_grid(scen_name~.)
 

# ggsave("final_energy_elec.svg",device = "svg",height=5,width=6)

```


### Final Energy by sector
```{r FE by sector,message=FALSE,warning=FALSE}

var_fe <- c("Final Energy|Residential and Commercial|Electricity" ,  "Final Energy|Industry|Electricity",  "Final Energy|Other Sector|Electricity","Final Energy|Transportation|Electricity" )
whole_fe_elec_1 <- whole %>% filter(variable %in% var_fe,period<2051)

ggplot()+ 
geom_line(data = whole_fe_elec_1, aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
    labs(
    x = "Year" ,
    y ="Final Energy by sector (EJ/yr)")+  theme_bw()+ 
  facet_grid(scen_name~variable,labeller = labeller(variable = label_wrap_gen(10)))+
  coord_cartesian(xlim = c(2005,2050),ylim=c(0,15))+
  #scale_colour_manual(values = myColors)+
     scale_x_continuous(breaks=seq(2010, 2050, 20))+
  scale_size_manual(values=c(1, 1.5))+scale_colour_manual(values=myColors)

# avoid overlap of axis labels
  # facet_wrap(~variable, labeller = labeller(variable = label_wrap_gen(10))) # wrapping labels



```
### Share of electricity in Final Energy
```{r}
var_fuel <- c("Final Energy","Final Energy|Electricity")
df.share <- whole %>% filter(variable %in% var_fuel)

df.share <- calc_addVariable(df.share,"Share"="`Final Energy|Electricity`/`Final Energy`")

ggplot()+
  geom_line(df.share %>% filter(period %in% c(2010:2030),variable=="Share"),mapping = aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=scen_name))+
  facet_grid(.~model)
```
### Final Energy by form
```{r}
vars <- c("Final Energy|Electricity","Final Energy|Solids","Final Energy|Liquids","Final Energy|Electricity","Final Energy|Gases","Final Energy|Heat","Final Energy|Hydrogen")

df.fe <- whole %>% filter(variable %in% vars)

ggplot()+
  geom_bar(df.fe %>% filter(period==2030),mapping = aes(x=model,y=value,group=interaction(model,scen_name),fill=variable),position="stack",stat="identity")+
  facet_wrap(~scen_name)+coord_flip()

```

### Final Energy
```{r}
whole_fe <- whole %>% filter(variable=="Final Energy",scen_name=="Delayed action")

ggplot()+ 
  geom_line(data = whole_fe %>% filter(period %in% c(2010:2050)),aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
 # facet_grid(scen_name~.)+
#  coord_cartesian(ylim = c(0,60),xlim=c(2010,2030))+ 
  theme_bw()+
  scale_colour_manual(values=myColors)+
  labs(y = "Final Energy (EJ/yr)",
       x="Year")
```

### Transmission loses
```{r transmission loss,warning=FALSE,fig.show='hold'}
#### DATA
# plotvar_1 <- c("Secondary Energy|Electricity|Biomass|w/ CCS",
#              "Secondary Energy|Electricity|Biomass|w/o CCS",
#              "Secondary Energy|Electricity|Other",
#              "Secondary Energy|Electricity|Geothermal",
#              "Secondary Energy|Electricity|Ocean",
#              "Secondary Energy|Electricity|Oil",
#              "Secondary Energy|Electricity|Hydro",
#              "Secondary Energy|Electricity|Nuclear",
#              "Secondary Energy|Electricity|Solar",
#              "Secondary Energy|Electricity|Wind",
#              "Secondary Energy|Electricity|Gas|w/ CCS",
#              "Secondary Energy|Electricity|Gas|w/o CCS",
#              "Secondary Energy|Electricity|Coal|w/ CCS",
#              "Secondary Energy|Electricity|Coal|w/o CCS")
# whole_se_elec <- whole %>% filter(variable %in% plotvar_1 )
# 
# ### Total Secondary Energy of Electricity by adding all SE techs
# whole_se_elec_sum <- whole_se_elec %>% 
#   group_by(model, scenario,unit, period,modscen, model_scope, scen_name,region) %>% 
#   summarise(value=sum(value)) %>% 
#   mutate(variable="Secondary Energy|Electricity")
# 
# whole_fe_elec <- whole %>% filter(variable=="Final Energy|Electricity")
# 
# 
# 
# whole_fe_elec <- whole_fe_elec %>% 
#   arrange(model,scenario)
# whole_se_elec_sum <- whole_se_elec_sum %>% 
#   arrange(model,scenario)
# 
# whole_se_elec_eff <- transform(whole_se_elec_sum,efficiency=whole_fe_elec$value/whole_se_elec_sum$value) 
# 
# # Historical SE 
#  hist_se_elec_var <- c( "SE|Electricity|Biomass (EJ/yr)",    
#     "SE|Electricity|Coal (EJ/yr)" ,      
#     "SE|Electricity|Gas (EJ/yr)"    ,    
#   "SE|Electricity|Geothermal (EJ/yr)",  "SE|Electricity|Hydro (EJ/yr)" ,     
# "SE|Electricity|Oil (EJ/yr)"       ,  "SE|Electricity|Solar (EJ/yr)" ,     
#  "SE|Electricity|Nuclear (EJ/yr)"   ,  "SE|Electricity|Wind (EJ/yr)"    )   
# hist_se_elec <- hist_and_botmup %>% filter(region=="IND", period %in% c(2005:2015), variable %in% hist_se_elec_var)
# # summing up
# hist_se_elec_sum <- hist_se_elec %>% 
#   group_by(region,period) %>% 
#   summarise(value=sum(value))
# hist_elec_eff <- transform(hist_se_elec_sum,efficiency=hist_fe_elec$value/value)
# 
# #### PLOT
# ggplot()+
#   geom_line(data = whole_se_elec_eff %>% filter(model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=efficiency,group=interaction(model,scen_name),linetype=scen_name,alpha=model)) +
# geom_line(data = whole_se_elec_eff %>% filter(!model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=efficiency,group=interaction(model,scen_name),color=model,linetype=scen_name))+
#     labs(
#     x = "Year" ,
#     y = "Electrical Efficiency",
#     color = "Global Model",
#     alpha="National Model",
#     linetype = "Scenario Type")+
#   theme_bw()+
#   coord_cartesian(xlim = c(2005,2050))+
#   annotate(geom = "point",x =c(2005:2015),y=hist_elec_eff$efficiency)

```

### Nuclear capacity
```{r}
whole_nuc <- whole %>% filter(variable=="Capacity|Electricity|Nuclear",scen_name=="Delayed action")


ggplot()+ 
  geom_line(data = whole_nuc %>% filter(period %in% c(2010:2050)),aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
 # facet_grid(scen_name~.)+
  geom_point(data = hist_IND %>% filter(variable=="Capacity|Electricity|Nuclear",model %in% c("CEA_ANNUAL","CEA_NEP"),period %in% c(2010:2050)),mapping = aes(x=period,y=value/1000,shape=scenario))+
  coord_cartesian(ylim = c(0,60),xlim=c(2010,2030))+ 
  theme_bw()+
  scale_colour_manual(values=myColors)+
  labs(y = "Nuclear Capacity (GW)",
       x="Year")

    # annotate(geom = "point",y=c(10.080,16.880) ,x=c(2022,2027),="blue")

```

### Net and Gross added capacity for Solar and Wind

```{r capacity addtions}
plotvar_1 <- c( "Capacity|Electricity|Solar",
             "Capacity|Electricity|Wind" )
# Assuming lifetime of 25 years for both solar and wind
whole_cap_add <- whole %>% filter(variable %in% plotvar_1) %>% 
  group_by(model, scenario, variable) %>% 
  mutate(additions=value-lag(value,default = value[1])) %>% 
  mutate(gross_additions=additions-lag(value,n = 5,default = additions[1]))
whole_cap_add$period <- whole_cap_add$period - 2.5


hist_IND$type <- "IND_historical"

CHN_hist <- data.frame(model= "CHN_historical",
type="CHN_historical",
region="CHN",
variable=c(rep("Capacity Additions|Electricity|Solar",8),rep("Capacity Additions|Electricity|Wind",8)),
value=c(1.915,1.29,12.48,8.97,17.32,34.13,54.11,44.21,16.65,15.19,15.1,20.05,34.18,16.72,16.53,20.26),
unit="GW/yr",
period=c(2011:2018,2011:2018))

IND_proj <- data.frame(model="IND_CEA",region="IND",
variable=c(rep("Capacity Additions|Electricity|Solar",9),rep("Capacity Additions|Electricity|Wind",9)),
unit="MW/yr",
period=c(rep(2019:2027,2)),
value=c(rep((100-21.651)/4,4),rep(10,5),rep((60-34.056)/4,4),rep(8,5)),
type="CEA_projections")

## For Solar
 ggplot()+
  geom_line(data = whole_cap_add %>% filter(variable=="Capacity|Electricity|Solar",period %in% c(2007.5:2047.5),scen_name!="NDC"),aes(x=period,y=additions/5,color=model))+
   geom_point(data = hist_IND %>% filter(variable=="Capacity Additions|Electricity|Solar",scenario=="historical",period %in% c(2014:2050)),  aes(x=period, y=value/1000,shape=type),color="black")+
  # geom_line(data = CHN_hist %>% filter(variable=="Capacity Additions|Electricity|Solar"),  aes(x=period, y=value,linetype=type))+
      geom_point(data = IND_proj %>% filter(variable=="Capacity Additions|Electricity|Solar"),mapping = aes(x = period,y = value,shape=type),color="blue")+
   facet_grid(model_scope~scen_name)+ 
  labs(y = "Net capacity additions-Solar (GW/yr)", x ="Period")+
  coord_cartesian(ylim=c(0,50))+
   theme_bw()+
  scale_colour_manual(values=myColors)
 
 ### Wind
ggplot()+
  geom_line(data = whole_cap_add %>% filter(variable=="Capacity|Electricity|Wind",period %in% c(2007.5:2047.5),scen_name!="NDC"), aes(x=period,y=additions/5,color=model))+
   geom_point(data = hist_IND %>% filter(variable=="Capacity Additions|Electricity|Wind",scenario=="historical",period %in% c(2014:2018)),  aes(x=period, y=value/1000,shape=type),color="black")+
   geom_point(data = IND_proj %>% filter(variable=="Capacity Additions|Electricity|Wind"),mapping = aes(x = period,y = value,shape=type),color="blue")+
   facet_grid(model_scope~scen_name)+ labs(y = "Net capacity additions-Wind (GW/yr)", x ="Period")+
  coord_cartesian(ylim=c(0,40))+theme_bw()+
  scale_colour_manual(values=myColors)


  
```

### Total Capacity
```{r total cap}
# source("plotstyle.R")
plotvar_1 <- c("Capacity|Electricity|Biomass|w/ CCS",
             "Capacity|Electricity|Biomass|w/o CCS",
             "Capacity|Electricity|Other",
             "Capacity|Electricity|Geothermal",
             "Capacity|Electricity|Ocean",
             "Capacity|Electricity|Oil",
             "Capacity|Electricity|Hydro",
             "Capacity|Electricity|Nuclear",
             "Capacity|Electricity|Solar|PV",
             "Capacity|Electricity|Wind",
             "Capacity|Electricity|Gas|w/ CCS",
             "Capacity|Electricity|Gas|w/o CCS",
             "Capacity|Electricity|Coal|w/ CCS",
             "Capacity|Electricity|Coal|w/o CCS")
whole_cap <- whole %>% filter(variable %in% plotvar_1)


ggplot()+
  geom_bar(data=whole_cap %>% filter(period==2030), aes(x=model,y=value, group=variable,fill=variable), position="fill",stat = "identity")+
  labs(
    x = "Model name" ,
    y = "Generation in 2030 (EJ/yr)",
    fill = "High Carbon",
    alpha = "Model Scope"
  ) +
  # theme_bw()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  # scale_fill_manual(values=plotstyle(plotvar_1))+
  #scale_alpha_discrete(range = c(0.95, 0.55))
  facet_grid(scen_name~model_scope,scales="free",space = "free_x")+geom_hline(yintercept = 0.4)+
  scale_colour_manual(values=myColors)
```


### Coal Capacity
```{r coal_plant_eff,warning=FALSE,fig.show='hold',out.width="50%",warning=FALSE,eval=FALSE}

whole_coal_cap <- whole %>% filter(variable %in% c("Capacity|Electricity|Coal|w/o CCS"),period %in% c(2005,2020))


# Current Capacity 
hist_coal_cap <- hist_and_botmup%>% filter( source =="EndCoal")
hist_coal_cap$value <- hist_coal_cap$value/1000 # MW to GW
# Historical Capacity- source http://www.indiaenergy.gov.in
hist_2 <- data.frame(energy=rep("coal",13),period=c(2006:2018),value=c(77003.79,
80187.53,
84981.5,
89040.04,
99433.85,
111442.05,
132824.89,
152416.62,
168973.58,
189013.91,
184587,
192163,
197452.5
))


# line_type_2(whole_coal_cap[whole_coal_cap$scen_name=="Delayed action",],hist_coal_cap[hist_coal_cap$variable=="Operating",])+   geom_point(data = hist_2,aes(y = value/1000,x=period),color="black",size=1.5)

+
      geom_hline(yintercept=197.5)+
        geom_text(x=2008,y=210,aes(label="Operating"),check_overlap = TRUE)+
          geom_hline(yintercept =  240)+        
  geom_text(x=2011,y=255,aes(label="Under Construction"),check_overlap = TRUE)+
              geom_hline(yintercept = 290)+
  geom_text(x=2015,y=310,aes(label="Under construction + planned"),check_overlap = TRUE)+
  labs(y="Coal Capacity (GW)")+theme(axis.title=element_text(size=14,face="bold"))+
  scale_colour_manual(values=myColors)
#ggsave("coalcapacity.svg",device = "svg",height=5,width = 6)

  

```

### Cumulative Coal Capacity
```{r,message=FALSE,warning=FALSE,eval=FALSE}
whole_coal_cap <- whole %>%  filter(variable=="Capacity|Electricity|Coal|w/o CCS" )
whole_coal_cap_add <- whole_coal_cap %>% 
  filter(period %in% c(2020,2030)) %>% 
  group_by(model,modscen,scen_name,model_scope) %>% 
  arrange(period) %>% 
  summarise(add=diff(value)) %>% 
  mutate(period="2020-2030")

hist_coal_cap <- hist_and_botmup %>% filter(Source=="EndCoal", variable %in% c("Operating","Construction","Announced + Pre-permit + Permitted")) %>% 
  add_row(variable="All future",period=2018,value=102699)
names(hist_coal_cap)[4] <- "variable"
names(hist_coal_cap)[5] <- "value"
hist_coal_cap$value <- hist_coal_cap$value
  # mutate(new=value[variable=="Construction"]+value[variable=="Announced + Pre-permit + Permitted"])


ggplot()+
  geom_bar( data = hist_coal_cap %>% filter(!variable %in% c("Operating","All future")),aes(x = period, y = value/1000,alpha=variable), stat="identity",width = 0.6)+
  geom_bar(data = whole_coal_cap_add %>% filter(period<2031),aes(x= scen_name,y= add,group=interaction(model,scen_name),fill=model),stat = "identity",position = "dodge",color="black")+scale_color_manual(values = myColors)+labs(
    y = " Coal capacity (GW)",
    x=""
  )+
  scale_alpha_discrete(range = c(0.95, 0.50))+ 
  scale_x_discrete(labels = function(variable) str_wrap(variable, width = 10))+theme_bw()+
  scale_colour_manual(values=myColors)



```  

### Gas capacity
```{r}

IND_proj <- data.frame(period=c(2022,2027),value=c(25735,25735),type="CEA_projections")

ggplot()+
  geom_line(data = whole %>% filter(variable=="Capacity|Electricity|Gas|w/o CCS",period<2051),aes(x = period,y=value,group=interaction(model,scen_name),color=model))+
  geom_point(data=IND_proj,aes(x=period,y=value/1000,shape=type),color="blue")+
  geom_point(data = hist_IND %>% filter(variable=="Capacity|Electricity|Gas"),aes(x=period,y=value/1000,shape=type),color="black")+
  facet_grid(model_scope~scen_name,scales = "free")+
  labs(x="Period",y="Capacity|Electricity|Gas|w/o CCS")+theme_bw()+
  scale_colour_manual(values=myColors)



```



### Renewable Energy Capacity
```{r REN capcacity}

plotvar_1 <- c("Capacity|Electricity|Biomass|w/ CCS",
             "Capacity|Electricity|Biomass|w/o CCS",
              "Capacity|Electricity|Hydro",
              "Capacity|Electricity|Solar",
             "Capacity|Electricity|Wind",
             "Capacity|Electricity|Solar|PV",
             "Capacity|Electricity|Nuclear"
               )
#Power capacity in 2030
# source("plotstyle.R")

whole_cap_elec <- whole[whole$variable %in% plotvar_1 & whole$period %in% c(2025,2030,2050),]


####### Capacity shares 
ggplot()+
  geom_bar(data=whole_cap_elec %>% filter(period %in%   c(2030),model_scope=="national"),aes(x=as.factor(period),y=value,group=variable,fill=variable),position = "fill",stat = "identity",color="red")+
  facet_grid(scen_name~model)+
    scale_fill_manual(values=mip::plotstyle(whole_cap_elec$variable))+
      theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(x="Period",
    y = "Installed capacity shares in 2030")+
    geom_bar(data=whole_cap_elec %>% filter(period %in% c(2030),model_scope=="global"),aes(x=as.factor(period),y=value,group=variable,fill=variable),position = "fill",stat = "identity")+
    scale_fill_manual(values=mip::plotstyle(whole_cap_elec$variable))+
  facet_grid(scen_name~model)+
  scale_colour_manual(values=myColors)

####### Absolute capacity
ggplot()+
  geom_bar(data=whole_cap_elec %>% filter(period %in% c(2030),variable=="Capacity|Electricity|Solar" ), aes(x=period,y=value,group=variable,fill=variable),position = "stack",stat = "identity")+facet_grid(scen_name~model)+
   scale_fill_manual(values=mip::plotstyle(plotvar_1))+
      theme(strip.text.x = element_text(angle = 90,size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  scale_colour_manual(values=myColors)
  

```
### Share of renewables to total capacity
```{r,eval=FALSE}
ren_vars <- c("Capacity|Electricity|Biomass|w/ CCS",
             "Capacity|Electricity|Biomass|w/o CCS",
              "Capacity|Electricity|Solar",
             "Capacity|Electricity|Wind",
             "Capacity|Electricity|Other",
             "Capacity|Electricity|Geothermal",
             "Capacity|Electricity|Ocean",
              "Capacity|Electricity|Hydro",
             "Capacity|Electricity|Nuclear")

all_cap_vars <- c("Capacity|Electricity|Biomass|w/ CCS",
             "Capacity|Electricity|Biomass|w/o CCS",
             "Capacity|Electricity|Other",
             "Capacity|Electricity|Geothermal",
             "Capacity|Electricity|Ocean",
             "Capacity|Electricity|Oil",
             "Capacity|Electricity|Hydro",
             "Capacity|Electricity|Nuclear",
             "Capacity|Electricity|Solar",
             "Capacity|Electricity|Wind",
             "Capacity|Electricity|Gas|w/ CCS",
             "Capacity|Electricity|Gas|w/o CCS",
             "Capacity|Electricity|Coal|w/ CCS",
             "Capacity|Electricity|Coal|w/o CCS")
whole_ren_cap <- whole %>% filter(variable  %in% ren_vars,period==2030,scen_name=="Delayed action")

whole_sum_ren_cap <-whole_ren_cap %>% 
  group_by(model) %>% 
  summarise(total_ren=sum(value))

whole_total_cap <- whole %>% filter(variable  %in% all_cap_vars,period==2030,scen_name=="Delayed action") 
whole_sum_total_cap <- whole_total_cap%>% 
  group_by(model) %>% 
  summarise(total_all=sum(value))

combined <- left_join(whole_total_ren_cap,whole_sum_total_cap,by="model") %>% mutate(share=total_ren/total_all)


```



### Efficiency of coal plants
```{r}

whole_pe_coal_elec <- whole %>%
                  filter(variable=="Primary Energy|Coal|Electricity", !modscen %in% c("AIM/Enduse 3.0 - INDC2030_low_V3" ,"AIM/Enduse 3.0 - NPi2020_low_V3"))%>% 
                  arrange(modscen)
whole_se_coal_elec <- whole %>% 
                      filter(variable %in% c("Secondary Energy|Electricity|Coal")) %>%
                      arrange(modscen)

whole_se_coal_elec_eff <- transform(whole_se_coal_elec,efficiency=whole_se_coal_elec$value/whole_pe_coal_elec$value) 
  

ggplot()+
  geom_line(data = whole_se_coal_elec_eff , aes(x=period,y=efficiency,group=interaction(model,scen_name),linetype=model_scope,color=model)) +
   labs(
    x = "Year" ,
    y = "Plant efficiency",
    color = "Model Scope",
    linetype = "Scenario Type"
  ) +
  theme_bw()+ 
  coord_cartesian(xlim = c(2005,2050))+
  scale_colour_manual(values=myColors)
  
```
###  Stranded capacity

```{r, eval=FALSE}
 # removing observations in whole_se_coal that are not in whole_cap_coal

whole_elec <- whole %>% filter(variable %in% c("Secondary Energy|Electricity|Coal|w/o CCS","Capacity|Electricity|Coal|w/o CCS"),period %in% c(2020:2050))

whole_elec <- as.quitte(whole_elec)

whole_needed_cap<- calc_addVariable(whole_elec, "Needed Capacity|Electricity|Coal|w/o CCS" = "`Secondary Energy|Electricity|Coal|w/o CCS`* 31.71 / 0.75",units = "GW")%>% select(-c(7,2))

whole_stranded_cap <- calc_addVariable(whole_needed_cap, "Stranded Capacity|Electricity|Coal|w/o CCS" = "`Capacity|Electricity|Coal|w/o CCS` - `Needed Capacity|Electricity|Coal|w/o CCS`",units = "GW")%>%
  spread(key = 7,value = 8)%>% 
  mutate(Difference= `Delayed action`-`Early action`) %>% 
  gather(key = "scen_name",value = "value",7:9) %>%   order.levels(scen_name=c("Delayed action","Early action","Difference")) %>% 
  order.levels(model_scope=c("global","national"))
  #filter(variable=="Stranded Capacity|Electricity|Coal|w/o CCS") %>% 
  #group_by(model,variable,model_scope,scen_name) %>% 
  #summarise(cum=sum(value)) %>% 
  #spread(key = 4,value = 5) %>% 
  #ungroup() %>% 
  #  %>% 
  # gather(key = "scen_name",value = "value",4:6) %>% 
  # order.levels(scen_name=c("Delayed action","Early action","Difference")) %>% 
  # order.levels(model_scope=c("global","national"))
  

whole_share_stranded_cap <- calc_addVariable(whole_stranded_cap, "Share Stranded Capacity|Electricity|Coal|w/o CCS" = "`Stranded Capacity|Electricity|Coal|w/o CCS` / `Capacity|Electricity|Coal|w/o CCS`",units = "GW")




ggplot()+
  geom_bar(data = whole_stranded_cap %>% filter(!model %in% c("REMIND","AIM"),period==2050,scen_name %in% c("Early action", "Delayed action"),variable=="Stranded Capacity|Electricity|Coal|w/o CCS"),mapping = aes(x=scen_name,y=value,fill=model),stat="identity") +
   facet_grid(.~model,labeller =label_wrap_gen(6,multi_line = TRUE))+
    theme(strip.text.x = element_text(size = 8),axis.text.x = element_text(angle = 90, hjust = 1))+
  labs(
    x = "Scenario" ,
    y = " Stranded capacity in 2050 (GW)")+
      scale_fill_manual(values = myColors)

ggplot()+ 
  geom_line(data =  whole_share_stranded_cap %>% filter(variable=="Share Stranded Capacity|Electricity|Coal|w/o CCS",scen_name %in% c("Early action", "Delayed action")), aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  facet_grid(scen_name~.)+
  theme_bw()+
  scale_colour_manual(values=myColors)+
  labs(y = "Share of stranded capacity in operating capacity")
  

ggplot()+
  geom_line(data = whole_stranded_cap %>% filter(variable=="Stranded Capacity|Electricity|Coal|w/o CCS",), aes(x=model,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope)) +
   labs(
    x = "Year" ,
    y = "Total stranded capacity of coal (GW)" ) +
  theme(legend.position="top")+ 
  facet_grid(scen_name~.)+scale_size_manual(values=c(1, 1.5))






```
### Capacity Factor
```{r}
whole_elec <- whole %>% filter(variable %in% c("Secondary Energy|Electricity|Coal|w/o CCS","Capacity|Electricity|Coal|w/o CCS"),period %in% c(2020:2050))

whole_cap_factor<- calc_addVariable(whole_elec, "Capacity Factor|Electricity|Coal|w/o CCS" = "`Secondary Energy|Electricity|Coal|w/o CCS` / `Capacity|Electricity|Coal|w/o CCS` * 31.71",only.new = TRUE)
 
whole_cap_factor <- calc_addVariable(whole_elec,"Capacity Factor|Electricity|Coal|w/o CCS" = "`Secondary Energy|Electricity|Coal|w/o CCS` / `Capacity|Electricity|Coal|w/o CCS` * 31.71")
ggplot()+
  geom_line(data = whole_cap_factor %>% filter(period<2051,variable=="Capacity Factor|Electricity|Coal|w/o CCS"), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope)) +
  scale_size_manual(values=c(1, 1.5))+
   labs(
    x = "Year" ,
    y = "Capacity Factor",
    color = "Model Scope",
    linetype = "Scenario Type"
  ) +
  theme_bw()+ 
  facet_grid(scen_name~.)+
geom_point(data = hist_IND %>% filter(variable=="Capacity Factor|Electricity|Coal"),mapping = aes(y=value/100, x=period),color="black")
```

### Capacity Factor solar and wind
```{r}
cf_vars <- c("Capacity|Electricity|Solar","Capacity|Electricity|Wind","Secondary Energy|Electricity|Solar","Secondary Energy|Electricity|Wind")

whole_for_cf <- whole %>% filter(variable %in% cf_vars,period<2051)

whole_cap_factor<- calc_addVariable(whole_for_cf, "Capacity Factor|Electricity|Solar" = "`Secondary Energy|Electricity|Solar` / `Capacity|Electricity|Solar` * 31.71",only.new = TRUE,
  "Capacity Factor|Electricity|Wind" = "`Secondary Energy|Electricity|Wind` / `Capacity|Electricity|Wind` * 31.71")

ggplot()+
  geom_line(whole_cap_factor %>% filter(variable =="Capacity Factor|Electricity|Solar"),mapping = aes(x =period, y=value, color=model, linetype=model_scope)) +
  facet_wrap("scen_name")+
  labs(y="Capacity Factor Solar")+
  scale_colour_manual(values=myColors)

ggplot()+
  geom_line(whole_cap_factor %>% filter(variable =="Capacity Factor|Electricity|Wind"),mapping = aes(x =period, y=value, color=model, linetype=model_scope)) +
  facet_wrap("scen_name")+
  labs(y="Capacity Factor Wind")+
  scale_colour_manual(values=myColors)

```


### Capital Costs
### Capital Cost of Solar PV 
```{r capital cost solar,eval=FALSE,message=FALSE,warning=FALSE,error=FALSE,purl=FALSE}
#plot capital cost
# plotvar <- c("Capital Cost|Electricity|Wind|Onshore")
#plotvar <- c("Capital Cost|Electricity|Gas|w/o CCS")
plotvar <- c("Capital Cost|Electricity|Solar|PV" )
whole_cap_cost <- whole[whole$variable==plotvar,]
localrate = 0.02 #https://www.xe.com/currencycharts/?from=INR&to=USD&view=10Y
whole_cap_cost[whole_cap_cost$model %in% c("India MARKAL","AIM/Enduse 3.0"),]$value <- whole_cap_cost[whole_cap_cost$model %in% c("India MARKAL","AIM/Enduse 3.0"),]$value*localrate
proj_iea <- hist_and_botmup %>% filter( period %in% c(2015:2050),variable =="spv",model=="IEA_WEO",region=="IND") 


ggplot()+
  geom_line(data = whole_cap_cost %>% filter(period %in% c(2010:2050),scen_name=="Delayed action"), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=model_scope,size=model_scope))+
 # facet_grid(scen_name~.)+
  scale_size_manual(values=c(1, 1.5))+
  #coord_cartesian(ylim=c(0,1.5))+
  labs(
    y = "Capital Costs for Solar PV (USD2010/KW)",
    x=""
    )+
  scale_colour_manual(values=myColors)+theme_bw()+
  theme(axis.title=element_text(size=12))

  geom_point(proj_iea,mapping = aes(x=period,y=value,shape=scenario))
#   ggplot()+
#   geom_line(data = whole_cap_cost %>% filter(model %in% c("India MARKAL","AIM/Enduse 3.0")), aes(x=period,y=value,group=interaction(model,scen_name),linetype=scen_name,alpha=model),size=1) +
# geom_line(data = whole_cap_cost %>% filter(!model %in% c("India MARKAL","AIM/Enduse 3.0"),period<2051), aes(x=period,y=value,group=interaction(model,scen_name),color=model,linetype=scen_name))+
#     labs(
#     x = "Year" ,
#     y = paste(whole_cap_cost$variable,"(",whole_cap_cost$unit,")"),
#     color = "Global Model",
#     alpha="National Model",
#     linetype = "Scenario Type")+
#   theme_bw()+ 
#   coord_cartesian(xlim = c(2005,2050))+
  # scale_colour_brewer(palette = "Set1")+
  scale_alpha_discrete(range = c(0.95, 0.60))
  
  # +
  #   geom_point(data = proj_iea%>%mutate(dummy="IEA"),aes(x = as.numeric(as.character(Year)),y=value,fill=dummy),size=1.5,shape=17)

#line_type_1(whole_cap_cost,proj_iea)
# line_type_2(whole_cap_cost,proj_iea)
```

### Capital Cost of Wind onshore
```{r capital cost wind,message=FALSE,eval=FALSE,warning=FALSE,error=FALSE,purl=FALSE}
#plot capital cost
plotvar <- c("Capital Cost|Electricity|Wind|Onshore")
#plotvar <- c("Capital Cost|Electricity|Coal|w/o CCS","Capital Cost|Electricity|Solar|PV" )
whole_cap_cost <- whole[whole$variable==plotvar,]
localrate = 0.02 #https://www.xe.com/currencycharts/?from=INR&to=USD&view=10Y
whole_cap_cost[whole_cap_cost$model %in% c("India MARKAL","AIM/Enduse 3.0"),]$value <- whole_cap_cost[whole_cap_cost$model %in% c("India MARKAL","AIM/Enduse 3.0"),]$value*localrate
proj_iea <- hist_and_botmup %>% filter( period %in% c(2015:2040),variable =="wind",Source=="IEA_WEO") 

```







### Primary Energy Total
```{r,eval=FALSE}
#### DATA
whole_pe_fossil <- whole %>% filter(variable %in% c("Primary Energy|Coal|Electricity","Primary Energy|Gas|Electricity"))


hist_pe_tot <- hist_and_botmup %>% filter(variable=="PE (EJ/yr)",period %in% c(2005:2015),region=="IND")
hist_pe_coal_elec <- hist_and_botmup %>% filter(variable=="PE|Coal|Electricity (EJ/yr)",period %in% c(2005:2015),region=="IND")
hist_pe_gas_elec <- hist_and_botmup %>% filter(variable=="PE|Gas|Electricity (EJ/yr)",period %in% c(2005:2015),region=="IND")

#### PLOTS

ggplot()+
  geom_line(data = whole %>% filter(variable == "Primary Energy",period<2050,!model %in% c("India MARKAL")), aes(x=period,y=value,group=interaction(model,scen_name),color=model))+
  facet_grid(variable~scen_name)+
 labs(  x = "Year")+ theme_bw()+
  annotate("point",x=c(2005:2015),y=hist_pe_tot$value)+
scale_color_manual(values = myColors)
```
### Primary Energy Coal for Electricity
```{r}
whole_pe_fossil <- whole %>% filter(variable %in% c("Primary Energy|Coal|Electricity","Primary Energy|Gas|Electricity"))
hist_pe_gas_elec <- hist_and_botmup %>% filter(variable=="PE|Gas|Electricity (EJ/yr)",period %in% c(2005:2015),region=="IND")

ggplot()+
  geom_line(data = whole_pe_fossil %>% filter(period<2050,variable=="Primary Energy|Gas|Electricity") , aes(x=period,y=value,group=interaction(model,scen_name),linetype=model_scope,color=model))+facet_grid(variable~scen_name)+
 labs(
    x = "Year"
    )+ theme_bw()+
     annotate("point",x=c(2005:2015),y=hist_pe_gas_elec$value)+
  scale_colour_manual(values=myColors)
```

### Primary Energy Gas for Electricity
```{r}
whole_pe_fossil <- whole %>% filter(variable %in% c("Primary Energy|Coal|Electricity","Primary Energy|Gas|Electricity"))
ggplot()+
  geom_line(data = whole_pe_fossil %>% filter(period<2050,variable=="Primary Energy|Gas|Electricity") , aes(x=period,y=value,group=interaction(model,scen_name),linetype=model_scope,color=model))+facet_grid(variable~scen_name)+
 labs(
    x = "Year")+ theme_bw()+
   annotate("point",x=c(2005:2015),y=hist_pe_gas_elec$value)
```
### Primary Energy by source
```{r}

pe_var <- c("Primary Energy|Biomass",
            "Primary Energy|Coal",
            "Primary Energy|Gas"  ,
            "Primary Energy|Hydro" ,
            "Primary Energy|Nuclear" ,
            "Primary Energy|Oil" ,
            "Primary Energy|Solar",
            "Primary Energy|Wind" )
whole_pe_all <- whole %>% filter(variable %in% pe_var)

ggplot()+
  geom_bar(data=whole_pe_all %>% filter(period==2020,scen_name=="Delayed action") , aes(x=model,y=value, group=variable,fill=variable),stat = "identity",width = 0.5)+
  labs(
    x = "Model name" ,
    y = "Share in Generation (2030)",
    fill = "Scenario Type",
    alpha = "Model Scope"
  ) +
  # theme_bw()+
  theme(axis.text.x = element_text(angle = 90, hjust = 1),panel.grid.major = element_line(colour = "black"),axis.ticks.length = unit(.25, "cm"))+
 #  scale_fill_manual(values=plotstyle(pe_var))+
  scale_alpha_discrete(range = c(0.95, 0.55))+
  facet_grid(~model_scope,scales="free",space = "free_x")+
  scale_colour_manual(values=myColors)
  
 
```


### Emissions intensity of GDP
```{r Emi intensity_GDP,message=FALSE,warning=FALSE}
emi_vars <- c("Emissions|CO2|Energy and Industrial Processes")
gdp_vars <- c("GDP|MER")

whole_nat <- whole %>% filter(model_scope=="national",variable %in% c("Emissions|CO2|Energy","Emissions|CO2|Other","GDP|MER"),period %in% c(2005,2030),scen_name=="Delayed action")



whole_nat <- calc_addVariable(whole_nat,"Emi|CO2|Tot"="`Emissions|CO2|Energy` + `Emissions|CO2|Other`",unit="Mt CO2/yr")

whole_nat <- calc_addVariable(whole_nat,"Emission Intensity"="`Emissions|CO2|Energy` / `GDP|MER`")
whole_nat_2 <- whole_nat %>% 
  spread(period,value) %>% 
  mutate(reduction=(`2005`-`2030`)/`2005`*100)


whole_emi_in <- whole %>% filter(variable %in% c("Emissions|Kyoto Gases",gdp_vars),period %in% c(2005,2030),scen_name=="Delayed action",model_scope=="global")

whole_emi_in_2 <- calc_addVariable(whole_emi_in,"Emission Intensity"="`Emissions|Kyoto Gases` / `GDP|MER`")

whole_emi_in_2 <- whole_emi_in_2 %>% 
  spread(period,value) %>% 
  mutate(reduction=(`2005`-`2030`)/`2005`*100)
```
### GDP
```{r}

loc = 0.015 #https://www.xe.com/currencycharts/?from=INR&to=USD&view=10Y

whole_gdp <- whole %>% filter(variable=="GDP|MER",period %in% c(2010:2050),scen_name=="Delayed action")
whole_gdp[whole_gdp$model_scope=="national",]$value <- whole_gdp[whole_gdp$model_scope=="national",]$value*loc

whole_pop <- whole %>% filter(variable=="Population",period %in% c(2010:2050),scen_name=="Delayed action")

whole_gdp_pc <- rbind(whole_gdp,whole_pop)

whole_gdp_pc <- calc_addVariable(whole_gdp_pc,"GDP|Capita"="`GDP|MER`/ `Population`")

ggplot()+ 
  geom_line(data = whole_gdp_pc %>% filter(variable=="GDP|Capita"), aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  #facet_grid(scen_name~.)+
  theme_bw()+
  scale_colour_manual(values=myColors)+
  labs(y = "GDP|MER (billion US$2010)")


                              
ggplot()+ 
  geom_line(data = whole_gdp %>% filter(scen_name=="Delayed action"), aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  #facet_grid(scen_name~.)+
  theme_bw()+
  scale_colour_manual(values=myColors)+
  labs(y = "GDP|MER (billion US$2010)")
```
### Carbon Price
```{r}

whole_cp <- whole %>% filter(variable=="Price|Carbon",period %in% c(2010:2050))

whole_cp_del <- whole_cp %>% 
    filter(scen_name=="Delayed action") %>% 
  group_by(modscen,scen_name)

whole_cp_el <- whole_cp %>% 
  filter(scen_name=="Early action") %>% 
  group_by(modscen,scen_name)

try_bl <- bind_cols(whole_cp_del,whole_cp_el) %>% group_by(model,period)%>%
  mutate(difference=value-value1)


try_bl <- try_bl[,c(1:8,21)] 
try_bl$scen_name <- "difference"
names(try_bl)[9] <- "value"

whole_cp_2 <- bind_rows(whole_cp,try_bl)

whole_cp_2 <- 
  factor.data.frame(whole_cp_2)%>%
order.levels(scen_name = c("Delayed action","Early action","difference"))

ggplot()+ 
  geom_line(data = whole_cp_2 %>% filter(scen_name!="difference"), aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  facet_grid(scen_name~.)+
  theme_bw()+
  scale_colour_manual(values=myColors)+
  labs(y = "Carbon Price (US$2010/t CO2)",x="")
 # coord_cartesian(ylim=c(0,600))
```

### Electricity Generation costs
```{r elec_generation_costs}
whole_ep <- whole %>% filter(variable=="Price|Secondary Energy|Electricity",period %in% c(2010:2100))

whole_ep_del <- whole_ep %>% 
    filter(scen_name=="Delayed action") %>% 
  group_by(modscen,scen_name)

whole_ep_el <- whole_ep %>% 
  filter(scen_name=="Early action") %>% 
  group_by(modscen,scen_name)

try_bl <- bind_cols(whole_ep_del,whole_ep_el) %>% group_by(model,period)%>%
  mutate(difference=value-value1)


try_bl <- try_bl[,c(1:8,21)] 
try_bl$scen_name <- "difference"
names(try_bl)[9] <- "value"

whole_ep_2 <- bind_rows(whole_ep,try_bl)

whole_ep_2 <- 
  factor.data.frame(whole_ep_2)%>%
order.levels(scen_name = c("Delayed action","Early action","difference"))


ggplot()+ 
  geom_line(data = whole_ep_2 %>% filter(scen_name %in% c("Delayed action","Early action")), aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  facet_grid(scen_name~.)+
  theme_bw()+
  scale_colour_manual(values=myColors)+
  labs(y = "Price of power generation (US$2010/GJ)")+
  coord_cartesian(ylim=c(-20,75),xlim = c(2010,2050))
```
### Consumption
```{r consumption}
# whole_c <- whole %>% filter(variable %in% c("Consumption","GDP|MER"),period %in% c(2010:2100))
# 
# whole_c <- calc_addVariable(whole_c, "Consumption per GDP" = "`Consumption` / `GDP|MER`")
# 
# 
# whole_c_del <- whole_c %>% 
#     filter(scen_name=="Delayed action") %>% 
#   group_by(modscen,scen_name)
# 
# whole_c_el <- whole_c %>% 
#   filter(scen_name=="Early action") %>% 
#   group_by(modscen,scen_name)
# 
# try_bl <- bind_cols(whole_c_del,whole_c_el) %>% group_by(model,period)%>%
#   mutate(difference=value-value1) %>% 
#   mutate(share=difference/value*100)
# 
# 
# try_bl <- try_bl[,c(1:8,22)] 
# try_bl$scen_name <- "share"
# names(try_bl)[9] <- "value"
# 
# whole_c_2 <- bind_rows(whole_c,try_bl)
# 
# whole_c_2 <- 
#   factor.data.frame(whole_c_2)%>%
# order.levels(scen_name = c("Delayed action","Early action","difference"))
# 
# whole_c_2 <- calc_addVariable(whole_c_2, "Share of Consumption Loss" = "`difference` / `Needed Capacity|Electricity|Coal|w/o CCS`",units = "GW")
# 
# ggplot()+ 
#   geom_line(data = try_bl, aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
#   scale_size_manual(values=c(1, 1.5))+
#   facet_grid(scen_name~.,scales = "free")+
#   theme_bw()+
#   scale_colour_manual(values=myColors)+
#   labs(y = "Consumption Loss due to delayed action (%)")
# 
# ggplot()+ 
#   geom_line(data = whole_c_2, aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
#   scale_size_manual(values=c(1, 1.5))+
#   facet_grid(scen_name~.,scales = "free")+
#   theme_bw()+
#   scale_colour_manual(values=myColors)+
#   labs(y = "Consumption Loss due to delayed action (US$2010 billion/yr)")
# 
# ggplot()+ 
#   geom_line(data = whole_c %>%  filter(variable=="Consumption per GDP"), aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
#   scale_size_manual(values=c(1, 1.5))+
#   facet_grid(scen_name~.,scales = "free")+
#   theme_bw()+
#   scale_colour_manual(values=myColors)+
#   labs(y = "Consumption Loss due to delayed action (US$2010 billion/yr)")
```
### Population
```{r}
whole_pop <- whole[whole$variable=="Population"& whole$scen_name=="Delayed action",]

ggplot()+ 
  geom_line(data = whole_pop %>% filter(period %in% c(2010:2050)), aes(x = period,y = value,color=model,linetype=model_scope,size=model_scope))+
  scale_size_manual(values=c(1, 1.5))+
  #facet_grid(scen_name~.,scales = "free")+
  theme_bw()+
  scale_colour_manual(values=myColors)+
  labs(y = "Population (million)")
```

```{r}
my_early <- whole %>% filter (scen_name=="Early action",variable=="Secondary Energy|Electricity|Coal|w/o CCS") %>% select(model,period, value) %>% arrange(model)

my_delay <-  whole %>% filter (scen_name=="Delayed action",variable=="Secondary Energy|Electricity|Coal|w/o CCS")%>% select(model,period, value) %>% arrange(model)

checksir <- left_join(my_early,my_delay,by=c("model","period"),suffix=c("_early","_delay")) %>% filter(period==2030) %>% mutate(diff=(value_delay-value_early)*277.778)
range(checksir$diff)
```

### Coal vs. solar capacity
```{r}
vars <- c("Capacity Additions|Electricity|Coal|w/o CCS","Capacity Additions|Electricity|Solar|PV")

vars2 <- c("Capacity|Electricity|Coal|w/o CCS","Capacity|Electricity|Solar|PV")

vars3 <- c("Secondary Energy|Electricity|Coal|w/o CCS","Secondary Energy|Electricity|Solar|PV","Secondary Energy|Electricity")

var_other <- c("Secondary Energy|Electricity|Biomass|w/ CCS",
             "Secondary Energy|Electricity|Biomass|w/o CCS",
             "Secondary Energy|Electricity|Other",
             "Secondary Energy|Electricity|Geothermal",
             "Secondary Energy|Electricity|Ocean",
             "Secondary Energy|Electricity|Oil",
             "Secondary Energy|Electricity|Hydro",
             "Secondary Energy|Electricity|Nuclear",
             "Secondary Energy|Electricity|Solar",
             "Secondary Energy|Electricity|Wind",
             "Secondary Energy|Electricity|Gas|w/ CCS",
             "Secondary Energy|Electricity|Gas|w/o CCS",
             "Secondary Energy|Electricity|Coal|w/ CCS",
             "Secondary Energy|Electricity|Coal|w/o CCS")


remind <- whole %>% filter(model=="India MARKAL",variable %in% vars3,period<2055,period>2015,scen_name %in% c("Early action","Delayed action")) %>% 
  spread(variable,value = value) %>% 
  mutate(`all_others`=`Secondary Energy|Electricity`-(`Secondary Energy|Electricity|Coal|w/o CCS`+`Secondary Energy|Electricity|Solar|PV`)) %>% 
  gather(9:12,key = "variable",value = "value")

ggplot()+
  geom_col(remind %>% filter(variable!="Secondary Energy|Electricity"),mapping = aes(x=scen_name,y=value,fill=variable),position="dodge") +
  facet_wrap(period~.,nrow = 2)
```


